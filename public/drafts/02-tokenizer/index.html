<!doctype html>
<html
  lang="en-us"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="dark"
  data-auto-appearance="true"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
  
    <meta http-equiv="content-language" content="en-us">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color">

  
  
    <title>Zig Compiler Internals Part 2: The Tokenizer &middot; Yohai&#39;s Blog</title>
    <meta name="title" content="Zig Compiler Internals Part 2: The Tokenizer &middot; Yohai&#39;s Blog">
  

  
  
  
  
  
  <link rel="canonical" href="http://localhost:1313/drafts/02-tokenizer/">
  

  
  
    <meta name="author" content="Yohai">
  
  

  
  <meta property="og:url" content="http://localhost:1313/drafts/02-tokenizer/">
  <meta property="og:site_name" content="Yohai&#39;s Blog">
  <meta property="og:title" content="Zig Compiler Internals Part 2: The Tokenizer">
  <meta property="og:description" content="Zig Compiler Internals Part 2: The Tokenizer # Converting source code into tokens with a hand-crafted state machine
Introduction # Before the Zig compiler can understand your code, it must first break it down into its smallest meaningful pieces: tokens. This process, called lexical analysis or tokenization, is the first step in the compilation pipeline.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="drafts">
    <meta property="article:published_time" content="2025-12-17T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-12-17T00:00:00+00:00">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Zig Compiler Internals Part 2: The Tokenizer">
  <meta name="twitter:description" content="Zig Compiler Internals Part 2: The Tokenizer # Converting source code into tokens with a hand-crafted state machine
Introduction # Before the Zig compiler can understand your code, it must first break it down into its smallest meaningful pieces: tokens. This process, called lexical analysis or tokenization, is the first step in the compilation pipeline.">

  
  
  
  
    
      
    
  
    
      
    
  
    
      
    
  
  
    
  

  
  
  
  
  
  

  

  
  
  
  
  
  
  
  
    
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.0975a8c7c266a0697f94839b45e1574c449de253527d44ed516d5c5c3c820c9389d7d86576faae12267b129f8749ecbf7581cddb636aba7690aa633b95aaa87d.css"
    integrity="sha512-CXWox8JmoGl/lIObReFXTESd4lNSfUTtUW1cXDyCDJOJ19hldvquEiZ7Ep&#43;HSey/dYHN22NqunaQqmM7laqofQ==">

  
  
  <script
    type="text/javascript"
    src="/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js"
    integrity="sha512-b0EXSzoFtoCCD&#43;CMrb&#43;l&#43;3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script>
  
  
  
  
  
  
    
    <script src="/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js" integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7&#43;kfJ6kKCJxQGC&#43;8wm&#43;Bz9JucDjDTGNew=="></script>
  

  
  
  
    
  
  
    
  
  
    
  
  
  
  
  
  
    
    <script
      defer
      type="text/javascript"
      id="script-bundle"
      src="/js/main.bundle.min.9cc802d09f28c6af56ceee7bc6e320a39251fdae98243f2a9942f221ac57a9f49c51609699a91794a7b2580ee1deaa8e4d794a68ffa94aa317c66e893ce51e02.js"
      integrity="sha512-nMgC0J8oxq9Wzu57xuMgo5JR/a6YJD8qmULyIaxXqfScUWCWmakXlKeyWA7h3qqOTXlKaP&#43;pSqMXxm6JPOUeAg=="
      data-copy="Copy"
      data-copied="Copied"></script>
  

  
  

<script src="/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js" integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj&#43;KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script>


























  

  

  

  

  





  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
  

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Drafts",
    "name": "Zig Compiler Internals Part 2: The Tokenizer",
    "headline": "Zig Compiler Internals Part 2: The Tokenizer",
    
    "abstract": "\u003ch1 class=\u0022relative group\u0022\u003eZig Compiler Internals Part 2: The Tokenizer\n    \u003cdiv id=\u0022zig-compiler-internals-part-2-the-tokenizer\u0022 class=\u0022anchor\u0022\u003e\u003c\/div\u003e\n    \n    \u003cspan\n        class=\u0022absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none\u0022\u003e\n        \u003ca class=\u0022text-primary-300 dark:text-neutral-700 !no-underline\u0022 href=\u0022#zig-compiler-internals-part-2-the-tokenizer\u0022 aria-label=\u0022Anchor\u0022\u003e#\u003c\/a\u003e\n    \u003c\/span\u003e\n    \n\u003c\/h1\u003e\n\u003cp\u003e\u003cem\u003eConverting source code into tokens with a hand-crafted state machine\u003c\/em\u003e\u003c\/p\u003e\n\u003chr\u003e\n\n\u003ch2 class=\u0022relative group\u0022\u003eIntroduction\n    \u003cdiv id=\u0022introduction\u0022 class=\u0022anchor\u0022\u003e\u003c\/div\u003e\n    \n    \u003cspan\n        class=\u0022absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none\u0022\u003e\n        \u003ca class=\u0022text-primary-300 dark:text-neutral-700 !no-underline\u0022 href=\u0022#introduction\u0022 aria-label=\u0022Anchor\u0022\u003e#\u003c\/a\u003e\n    \u003c\/span\u003e\n    \n\u003c\/h2\u003e\n\u003cp\u003eBefore the Zig compiler can understand your code, it must first break it down into its smallest meaningful pieces: \u003cstrong\u003etokens\u003c\/strong\u003e. This process, called \u003cstrong\u003elexical analysis\u003c\/strong\u003e or \u003cstrong\u003etokenization\u003c\/strong\u003e, is the first step in the compilation pipeline.\u003c\/p\u003e",
    "inLanguage": "en-us",
    "url" : "http://localhost:1313/drafts/02-tokenizer/",
    "author" : {
      "@type": "Person",
      "name": "Yohai"
    },
    "copyrightYear": "2025",
    "dateCreated": "2025-12-17T00:00:00\u002b00:00",
    "datePublished": "2025-12-17T00:00:00\u002b00:00",
    
    "dateModified": "2025-12-17T00:00:00\u002b00:00",
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "7018"
  }]
  </script>



  
  

  
  

  
  

  
  

  
  
</head>


















  
  
  <body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
    <div id="the-top" class="absolute flex self-center">
      <a
        class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content">
        <span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
        Skip to main content
      </a>
    </div>
    
    
      













<div
  class="main-menu flex items-center justify-between py-6 md:justify-start gap-x-3 pt-[2px] pr-2 md:pr-4 pb-[3px] pl-0">
  
  

  <div class="flex flex-1 items-center justify-between">
    <nav class="flex space-x-3">
      
        <a href="/" class="text-base font-medium">
          Yohai&rsquo;s Blog
        </a>
      
    </nav>
    
  <nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12">
    
      
        
  <a
  href="/posts/"
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  aria-label="Posts"
  title="Posts">
  
  
    <p class="text-base font-medium">
      Posts
    </p>
  
</a>



      
        
  <a
  href="/drafts/"
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  aria-label="Drafts"
  title="Drafts">
  
  
    <p class="text-base font-medium">
      Drafts
    </p>
  
</a>



      
        
  <a
  href="/tags/"
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  aria-label="Tags"
  title="Tags">
  
  
    <p class="text-base font-medium">
      Tags
    </p>
  
</a>



      
    

    

    

    
      <button
        id="search-button"
        aria-label="Search"
        class="text-base hover:text-primary-600 dark:hover:text-primary-400"
        title="Search (/)">
        <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
      </button>
    

    
      <div class=" flex items-center">
        <button
          id="appearance-switcher"
          aria-label="Dark mode switcher"
          type="button"
          class="text-base hover:text-primary-600 dark:hover:text-primary-400">
          <div class="flex items-center justify-center dark:hidden">
            <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span>
          </div>
          <div class="items-center justify-center hidden dark:flex">
            <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span>
          </div>
        </button>
      </div>
    
  </nav>

    
  <div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12">
    <span></span>

    

    

    
      <button
        id="search-button-mobile"
        aria-label="Search"
        class="text-base hover:text-primary-600 dark:hover:text-primary-400"
        title="Search (/)">
        <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
      </button>
    

    
      <button
        id="appearance-switcher-mobile"
        aria-label="Dark mode switcher"
        type="button"
        class="text-base hover:text-primary-600 dark:hover:text-primary-400 me-1">
        <div class="flex items-center justify-center dark:hidden">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span>
        </div>
        <div class="items-center justify-center hidden dark:flex">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span>
        </div>
      </button>
    
  </div>

  </div>
  
  <div class="-my-2 md:hidden">
    <div id="menu-button" class="block">
      
        <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>
</span>
        </div>
        <div
          id="menu-wrapper"
          class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 pt-[5px]">
          <ul
            class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none text-end max-w-7xl">
            <li id="menu-close-button">
              <span
                class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">
                <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
              </span>
            </li>

            
              
  <li class="mt-1">
  <a
    href="/posts/"
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    aria-label="Posts"
    title="Posts">
    
    
      <p class="text-bg font-bg">
        Posts
      </p>
    
  </a>
</li>



            
              
  <li class="mt-1">
  <a
    href="/drafts/"
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    aria-label="Drafts"
    title="Drafts">
    
    
      <p class="text-bg font-bg">
        Drafts
      </p>
    
  </a>
</li>



            
              
  <li class="mt-1">
  <a
    href="/tags/"
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    aria-label="Tags"
    title="Tags">
    
    
      <p class="text-bg font-bg">
        Tags
      </p>
    
  </a>
</li>



            

          </ul>
          
        </div>
      
    </div>
  </div>

</div>





    
    <div class="relative flex flex-col grow">
      <main id="main-content" class="grow">
        
  
  <article>
    
    

    
    <header id="single_header" class="mt-5 max-w-prose">
      
        <ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
  
  
    
  
    
  
  <li class="hidden">
    <a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href="/"
      >Yohai&#39;s Blog</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline">
    <a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href="/drafts/"
      >Drafts</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="hidden">
    <a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href="/drafts/02-tokenizer/"
      >Zig Compiler Internals Part 2: The Tokenizer</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        Zig Compiler Internals Part 2: The Tokenizer
      </h1>
      <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        





  
  



  

  
  
  
    
  

  

  
    
  

  

  
    
  

  
    
  

  

  

  

  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2025-12-17T00:00:00&#43;00:00">December 17, 2025</time><span class="px-2 text-primary-500">&middot;</span><span>7018 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">33 mins</span>
    

    
    
  </div>

  

  
  

  
  



      </div>
      
        
  
  
  
  
  
  

  

  
    
    
<div class="flex author">
  
  <div class="place-self-center">
    
      <div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">
        Author
      </div>
      <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
        Yohai
      </div>
    
    
    <div class="text-2xl sm:text-lg">
</div>
  </div>
</div>

  

  

  
    <div class="mb-5"></div>
  

      
    </header>

    
    <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
      
      
      
      
      
        <div class="order-first lg:ml-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs">
          <div class="toc ps-5 print:hidden lg:sticky lg:top-10">
            
              <details
  open
  id="TOCView"
  class="toc-right mt-0 overflow-y-auto overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg -ms-5 ps-5 pe-2 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#the-big-picture">The Big Picture</a></li>
    <li><a href="#the-tokenizer-at-a-glance">The Tokenizer at a Glance</a></li>
    <li><a href="#token-structure">Token Structure</a></li>
    <li><a href="#design-principles-why-no-allocations">Design Principles: Why No Allocations?</a></li>
    <li><a href="#understanding-the-state-machine">Understanding the State Machine</a>
      <ul>
        <li><a href="#state-machine-overview">State Machine Overview</a></li>
        <li><a href="#the-41-states">The 41 States</a></li>
      </ul>
    </li>
    <li><a href="#step-by-step-example-tokenizing-const">Step-by-Step Example: Tokenizing <code>const</code></a>
      <ul>
        <li><a href="#visual-token-extraction">Visual Token Extraction</a></li>
      </ul>
    </li>
    <li><a href="#identifier-state-machine-source-code-deep-dive">Identifier State Machine (Source Code Deep Dive)</a>
      <ul>
        <li><a href="#entry-point-start-state-lines-431-434">Entry Point: START State (Lines 431-434)</a></li>
        <li><a href="#identifier-state-loop-lines-664-675">Identifier State Loop (Lines 664-675)</a></li>
        <li><a href="#keyword-lookup-compile-time-perfect-hash-lines-12-63">Keyword Lookup: Compile-Time Perfect Hash (Lines 12-63)</a></li>
        <li><a href="#visual-state-machine">Visual State Machine</a></li>
        <li><a href="#example-trace-tokenizing-const">Example Trace: Tokenizing <code>const</code></a></li>
        <li><a href="#valid-vs-invalid-identifiers">Valid vs Invalid Identifiers</a></li>
        <li><a href="#escaped-identifiers--syntax">Escaped Identifiers: <code>@&#34;...&#34;</code> Syntax</a></li>
      </ul>
    </li>
    <li><a href="#operator-state-machines">Operator State Machines</a>
      <ul>
        <li><a href="#the-plus-operator-family">The Plus Operator Family</a></li>
        <li><a href="#code-for-plus-states">Code for Plus States</a></li>
      </ul>
    </li>
    <li><a href="#string-literal-state-machine">String Literal State Machine</a>
      <ul>
        <li><a href="#example-tokenizing-hellonworld">Example: Tokenizing <code>&#34;hello\nworld&#34;</code></a></li>
      </ul>
    </li>
    <li><a href="#number-parsing-state-machine">Number Parsing State Machine</a>
      <ul>
        <li><a href="#number-examples">Number Examples</a></li>
      </ul>
    </li>
    <li><a href="#comment-state-machine">Comment State Machine</a>
      <ul>
        <li><a href="#comment-examples">Comment Examples</a></li>
      </ul>
    </li>
    <li><a href="#token-types-reference">Token Types Reference</a>
      <ul>
        <li><a href="#literals">Literals</a></li>
        <li><a href="#operators-showing-state-machine-complexity">Operators (showing state machine complexity)</a></li>
        <li><a href="#keywords-59-total">Keywords (59 total)</a></li>
      </ul>
    </li>
    <li><a href="#the-tokenizer-structure">The Tokenizer Structure</a></li>
    <li><a href="#the-main-tokenization-loop">The Main Tokenization Loop</a></li>
    <li><a href="#full-tokenization-example">Full Tokenization Example</a></li>
    <li><a href="#error-recovery-and-invalid-tokens-deep-dive">Error Recovery and Invalid Tokens (Deep Dive)</a>
      <ul>
        <li><a href="#what-causes-invalid-tokens">What Causes Invalid Tokens?</a></li>
        <li><a href="#the-invalid-state-actual-source-code">The Invalid State (Actual Source Code)</a></li>
        <li><a href="#how-different-errors-enter-invalid-state">How Different Errors Enter Invalid State</a></li>
        <li><a href="#visual-invalid-token-state-machine">Visual Invalid Token State Machine</a></li>
        <li><a href="#example-1-illegal-character">Example 1: Illegal Character</a></li>
        <li><a href="#example-2-unterminated-string">Example 2: Unterminated String</a></li>
        <li><a href="#example-3-multiple-errors">Example 3: Multiple Errors</a></li>
        <li><a href="#example-4-control-characters">Example 4: Control Characters</a></li>
        <li><a href="#example-5-invalid-tab-in-comment">Example 5: Invalid Tab in Comment</a></li>
        <li><a href="#special-case-invalid_periodasterisks">Special Case: invalid_periodasterisks</a></li>
        <li><a href="#recovery-properties">Recovery Properties</a></li>
        <li><a href="#how-the-parser-handles-invalid-tokens">How the Parser Handles Invalid Tokens</a></li>
        <li><a href="#test-cases-from-the-tokenizer">Test Cases from the Tokenizer</a></li>
      </ul>
    </li>
    <li><a href="#performance-considerations">Performance Considerations</a></li>
    <li><a href="#try-it-yourself">Try It Yourself</a></li>
    <li><a href="#further-reading">Further Reading</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#the-big-picture">The Big Picture</a></li>
    <li><a href="#the-tokenizer-at-a-glance">The Tokenizer at a Glance</a></li>
    <li><a href="#token-structure">Token Structure</a></li>
    <li><a href="#design-principles-why-no-allocations">Design Principles: Why No Allocations?</a></li>
    <li><a href="#understanding-the-state-machine">Understanding the State Machine</a>
      <ul>
        <li><a href="#state-machine-overview">State Machine Overview</a></li>
        <li><a href="#the-41-states">The 41 States</a></li>
      </ul>
    </li>
    <li><a href="#step-by-step-example-tokenizing-const">Step-by-Step Example: Tokenizing <code>const</code></a>
      <ul>
        <li><a href="#visual-token-extraction">Visual Token Extraction</a></li>
      </ul>
    </li>
    <li><a href="#identifier-state-machine-source-code-deep-dive">Identifier State Machine (Source Code Deep Dive)</a>
      <ul>
        <li><a href="#entry-point-start-state-lines-431-434">Entry Point: START State (Lines 431-434)</a></li>
        <li><a href="#identifier-state-loop-lines-664-675">Identifier State Loop (Lines 664-675)</a></li>
        <li><a href="#keyword-lookup-compile-time-perfect-hash-lines-12-63">Keyword Lookup: Compile-Time Perfect Hash (Lines 12-63)</a></li>
        <li><a href="#visual-state-machine">Visual State Machine</a></li>
        <li><a href="#example-trace-tokenizing-const">Example Trace: Tokenizing <code>const</code></a></li>
        <li><a href="#valid-vs-invalid-identifiers">Valid vs Invalid Identifiers</a></li>
        <li><a href="#escaped-identifiers--syntax">Escaped Identifiers: <code>@&#34;...&#34;</code> Syntax</a></li>
      </ul>
    </li>
    <li><a href="#operator-state-machines">Operator State Machines</a>
      <ul>
        <li><a href="#the-plus-operator-family">The Plus Operator Family</a></li>
        <li><a href="#code-for-plus-states">Code for Plus States</a></li>
      </ul>
    </li>
    <li><a href="#string-literal-state-machine">String Literal State Machine</a>
      <ul>
        <li><a href="#example-tokenizing-hellonworld">Example: Tokenizing <code>&#34;hello\nworld&#34;</code></a></li>
      </ul>
    </li>
    <li><a href="#number-parsing-state-machine">Number Parsing State Machine</a>
      <ul>
        <li><a href="#number-examples">Number Examples</a></li>
      </ul>
    </li>
    <li><a href="#comment-state-machine">Comment State Machine</a>
      <ul>
        <li><a href="#comment-examples">Comment Examples</a></li>
      </ul>
    </li>
    <li><a href="#token-types-reference">Token Types Reference</a>
      <ul>
        <li><a href="#literals">Literals</a></li>
        <li><a href="#operators-showing-state-machine-complexity">Operators (showing state machine complexity)</a></li>
        <li><a href="#keywords-59-total">Keywords (59 total)</a></li>
      </ul>
    </li>
    <li><a href="#the-tokenizer-structure">The Tokenizer Structure</a></li>
    <li><a href="#the-main-tokenization-loop">The Main Tokenization Loop</a></li>
    <li><a href="#full-tokenization-example">Full Tokenization Example</a></li>
    <li><a href="#error-recovery-and-invalid-tokens-deep-dive">Error Recovery and Invalid Tokens (Deep Dive)</a>
      <ul>
        <li><a href="#what-causes-invalid-tokens">What Causes Invalid Tokens?</a></li>
        <li><a href="#the-invalid-state-actual-source-code">The Invalid State (Actual Source Code)</a></li>
        <li><a href="#how-different-errors-enter-invalid-state">How Different Errors Enter Invalid State</a></li>
        <li><a href="#visual-invalid-token-state-machine">Visual Invalid Token State Machine</a></li>
        <li><a href="#example-1-illegal-character">Example 1: Illegal Character</a></li>
        <li><a href="#example-2-unterminated-string">Example 2: Unterminated String</a></li>
        <li><a href="#example-3-multiple-errors">Example 3: Multiple Errors</a></li>
        <li><a href="#example-4-control-characters">Example 4: Control Characters</a></li>
        <li><a href="#example-5-invalid-tab-in-comment">Example 5: Invalid Tab in Comment</a></li>
        <li><a href="#special-case-invalid_periodasterisks">Special Case: invalid_periodasterisks</a></li>
        <li><a href="#recovery-properties">Recovery Properties</a></li>
        <li><a href="#how-the-parser-handles-invalid-tokens">How the Parser Handles Invalid Tokens</a></li>
        <li><a href="#test-cases-from-the-tokenizer">Test Cases from the Tokenizer</a></li>
      </ul>
    </li>
    <li><a href="#performance-considerations">Performance Considerations</a></li>
    <li><a href="#try-it-yourself">Try It Yourself</a></li>
    <li><a href="#further-reading">Further Reading</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
  </div>
</details>



            
          </div>
        </div>
      


      <div class="min-w-0 min-h-0 max-w-fit">
        

        <div class="article-content max-w-prose mb-20">
          
<h1 class="relative group">Zig Compiler Internals Part 2: The Tokenizer
    <div id="zig-compiler-internals-part-2-the-tokenizer" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#zig-compiler-internals-part-2-the-tokenizer" aria-label="Anchor">#</a>
    </span>
    
</h1>
<p><em>Converting source code into tokens with a hand-crafted state machine</em></p>
<hr>

<h2 class="relative group">Introduction
    <div id="introduction" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#introduction" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>Before the Zig compiler can understand your code, it must first break it down into its smallest meaningful pieces: <strong>tokens</strong>. This process, called <strong>lexical analysis</strong> or <strong>tokenization</strong>, is the first step in the compilation pipeline.</p>
<p>In this article, we&rsquo;ll explore Zig&rsquo;s tokenizer, a beautifully hand-crafted state machine that efficiently converts source text into a stream of tokens.</p>

<h2 class="relative group">The Big Picture
    <div id="the-big-picture" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#the-big-picture" aria-label="Anchor">#</a>
    </span>
    
</h2>
<pre tabindex="0"><code>┌─────────────────────────────────────────────────────────────────────────┐
│                         SOURCE CODE                                      │
│                                                                          │
│    const x: u32 = 42;                                                    │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         TOKENIZER                                        │
│                                                                          │
│   ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐              │
│   │  State  │───▶│  Read   │───▶│ Decide  │───▶│  Emit   │              │
│   │ Machine │    │  Char   │    │  Next   │    │  Token  │              │
│   └─────────┘    └─────────┘    └─────────┘    └─────────┘              │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         TOKEN STREAM                                     │
│                                                                          │
│   [const] [x] [:] [u32] [=] [42] [;] [EOF]                               │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre>
<h2 class="relative group">The Tokenizer at a Glance
    <div id="the-tokenizer-at-a-glance" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#the-tokenizer-at-a-glance" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p><strong>Location</strong>: <code>lib/std/zig/tokenizer.zig</code> (1,769 lines)</p>
<p>Key statistics:</p>
<ul>
<li><strong>185 token types</strong> (keywords, operators, literals, etc.)</li>
<li><strong>41 states</strong> in the state machine</li>
<li><strong>59 keywords</strong> recognized</li>
<li>Hand-written, no parser generators</li>
</ul>

<h2 class="relative group">Token Structure
    <div id="token-structure" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#token-structure" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>Every token in Zig has a simple structure:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">pub</span><span class="w"> </span><span class="kr">const</span><span class="w"> </span><span class="n">Token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">tag</span><span class="o">:</span><span class="w"> </span><span class="n">Tag</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">loc</span><span class="o">:</span><span class="w"> </span><span class="n">Loc</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kr">pub</span><span class="w"> </span><span class="kr">const</span><span class="w"> </span><span class="n">Loc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">start</span><span class="o">:</span><span class="w"> </span><span class="kt">usize</span><span class="p">,</span><span class="w">  </span><span class="c1">// Byte offset in source
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="n">end</span><span class="o">:</span><span class="w"> </span><span class="kt">usize</span><span class="p">,</span><span class="w">    </span><span class="c1">// Byte offset in source
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Tokens don&rsquo;t store the actual text - they just reference positions in the original source:</p>
<pre tabindex="0"><code>Source: &#34;const x: u32 = 42;&#34;
         ▲     ▲
         │     │
         │     └── end = 5
         └── start = 0

Token { .tag = .keyword_const, .loc = { .start = 0, .end = 5 } }

To get the text: source[0..5] = &#34;const&#34;
</code></pre><p>This is memory-efficient and enables zero-copy parsing.</p>

<h2 class="relative group">Design Principles: Why No Allocations?
    <div id="design-principles-why-no-allocations" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#design-principles-why-no-allocations" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>One of the most striking aspects of Zig&rsquo;s tokenizer is that <strong>it performs zero heap allocations</strong>. Look at the API - there&rsquo;s no <code>Allocator</code> parameter anywhere:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">init</span><span class="p">(</span><span class="n">source</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span><span class="kr">const</span><span class="w"> </span><span class="kt">u8</span><span class="p">)</span><span class="w"> </span><span class="n">Tokenizer</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Tokenizer</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="n">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>This is possible because of two key design decisions:</p>
<pre tabindex="0"><code>┌─────────────────────────────────────────────────────────────────────┐
│ WHY ZERO ALLOCATIONS?                                                │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│ 1. TOKENS STORE INDICES, NOT STRINGS                                │
│                                                                      │
│    Instead of:  Token { text: &#34;const&#34; }     ← needs allocation      │
│    We store:    Token { start: 0, end: 5 }  ← just two integers     │
│                                                                      │
│    To get the text: source[token.loc.start..token.loc.end]          │
│                                                                      │
│ 2. NULL-TERMINATED SOURCE BUFFER                                    │
│                                                                      │
│    The source is [:0]const u8 - guaranteed null terminator          │
│    This means:                                                       │
│    • No bounds checking needed on every character                   │
│    • EOF detection is &#34;free&#34; (just check for \0)                    │
│    • No need to store buffer length separately                      │
│                                                                      │
│ Result: The tokenizer is blazingly fast with zero memory overhead   │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
</code></pre>
<h2 class="relative group">Understanding the State Machine
    <div id="understanding-the-state-machine" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#understanding-the-state-machine" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>The tokenizer works like a vending machine - it reads characters one by one and transitions between states until it has a complete token.</p>

<h3 class="relative group">State Machine Overview
    <div id="state-machine-overview" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#state-machine-overview" aria-label="Anchor">#</a>
    </span>
    
</h3>
<pre tabindex="0"><code>                              ┌─────────────────────────────────────────┐
                              │              START STATE                 │
                              │                                          │
                              │   Read first character, decide where     │
                              │   to go based on what we see             │
                              └─────────────────────────────────────────┘
                                                 │
               ┌─────────────────┬───────────────┼───────────────┬─────────────────┐
               │                 │               │               │                 │
               ▼                 ▼               ▼               ▼                 ▼
        ┌─────────────┐   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐   ┌─────────────┐
        │ a-z, A-Z, _ │   │    0-9      │ │   &#34; or &#39;    │ │  + - * / =  │   │   @ sign    │
        │             │   │             │ │             │ │   etc...    │   │             │
        │ IDENTIFIER  │   │   NUMBER    │ │   STRING    │ │  OPERATOR   │   │  BUILTIN    │
        └─────────────┘   └─────────────┘ └─────────────┘ └─────────────┘   └─────────────┘
               │                 │               │               │                 │
               ▼                 ▼               ▼               ▼                 ▼
        ┌─────────────────────────────────────────────────────────────────────────────────┐
        │                              EMIT TOKEN                                          │
        │                                                                                  │
        │   Return to START state, ready for next token                                    │
        └─────────────────────────────────────────────────────────────────────────────────┘
</code></pre>
<h3 class="relative group">The 41 States
    <div id="the-41-states" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#the-41-states" aria-label="Anchor">#</a>
    </span>
    
</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">const</span><span class="w"> </span><span class="n">State</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">start</span><span class="p">,</span><span class="w">                              </span><span class="c1">// Initial state
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">expect_newline</span><span class="p">,</span><span class="w">                     </span><span class="c1">// After certain tokens
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Identifiers and keywords
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">identifier</span><span class="p">,</span><span class="w">                         </span><span class="c1">// Reading: foo, Bar, _name
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">builtin</span><span class="p">,</span><span class="w">                            </span><span class="c1">// Reading: @import, @as
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Strings and characters
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">string_literal</span><span class="p">,</span><span class="w">                     </span><span class="c1">// Reading: &#34;hello&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">string_literal_backslash</span><span class="p">,</span><span class="w">           </span><span class="c1">// Reading: &#34;hel\...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">multiline_string_literal_line</span><span class="p">,</span><span class="w">      </span><span class="c1">// Reading: \\text
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">char_literal</span><span class="p">,</span><span class="w">                       </span><span class="c1">// Reading: &#39;x&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">char_literal_backslash</span><span class="p">,</span><span class="w">             </span><span class="c1">// Reading: &#39;\...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">backslash</span><span class="p">,</span><span class="w">                          </span><span class="c1">// Saw: \
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Multi-character operators
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">equal</span><span class="p">,</span><span class="w">                              </span><span class="c1">// Saw: =  (could be = or ==)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">bang</span><span class="p">,</span><span class="w">                               </span><span class="c1">// Saw: !  (could be ! or !=)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">pipe</span><span class="p">,</span><span class="w">                               </span><span class="c1">// Saw: |  (could be | or || or |=)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">minus</span><span class="p">,</span><span class="w">                              </span><span class="c1">// Saw: -  (could be - or -= or -%)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">minus_percent</span><span class="p">,</span><span class="w">                      </span><span class="c1">// Saw: -%
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">minus_pipe</span><span class="p">,</span><span class="w">                         </span><span class="c1">// Saw: -|
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">asterisk</span><span class="p">,</span><span class="w">                           </span><span class="c1">// Saw: *  (could be * or *= or *%)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">asterisk_percent</span><span class="p">,</span><span class="w">                   </span><span class="c1">// Saw: *%
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">asterisk_pipe</span><span class="p">,</span><span class="w">                      </span><span class="c1">// Saw: *|
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">slash</span><span class="p">,</span><span class="w">                              </span><span class="c1">// Saw: /  (could be / or /= or //)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">plus</span><span class="p">,</span><span class="w">                               </span><span class="c1">// Saw: +  (could be + or += or +%)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">plus_percent</span><span class="p">,</span><span class="w">                       </span><span class="c1">// Saw: +%
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">plus_pipe</span><span class="p">,</span><span class="w">                          </span><span class="c1">// Saw: +|
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">ampersand</span><span class="p">,</span><span class="w">                          </span><span class="c1">// Saw: &amp;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">caret</span><span class="p">,</span><span class="w">                              </span><span class="c1">// Saw: ^
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">percent</span><span class="p">,</span><span class="w">                            </span><span class="c1">// Saw: %
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Comments
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">line_comment_start</span><span class="p">,</span><span class="w">                 </span><span class="c1">// Saw: //
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">line_comment</span><span class="p">,</span><span class="w">                       </span><span class="c1">// Inside: // comment text
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">doc_comment_start</span><span class="p">,</span><span class="w">                  </span><span class="c1">// Saw: ///
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">doc_comment</span><span class="p">,</span><span class="w">                        </span><span class="c1">// Inside: /// doc text
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Numbers
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">int</span><span class="p">,</span><span class="w">                                </span><span class="c1">// Reading: 123
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">int_exponent</span><span class="p">,</span><span class="w">                       </span><span class="c1">// Reading: 1e...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">int_period</span><span class="p">,</span><span class="w">                         </span><span class="c1">// Reading: 1.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">float</span><span class="p">,</span><span class="w">                              </span><span class="c1">// Reading: 1.23
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">float_exponent</span><span class="p">,</span><span class="w">                     </span><span class="c1">// Reading: 1.23e-4
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Angle brackets (tricky!)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">angle_bracket_left</span><span class="p">,</span><span class="w">                 </span><span class="c1">// Saw: &lt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">angle_bracket_angle_bracket_left</span><span class="p">,</span><span class="w">   </span><span class="c1">// Saw: &lt;&lt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">angle_bracket_angle_bracket_left_pipe</span><span class="p">,</span><span class="w"> </span><span class="c1">// Saw: &lt;&lt;|
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">angle_bracket_right</span><span class="p">,</span><span class="w">                </span><span class="c1">// Saw: &gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">angle_bracket_angle_bracket_right</span><span class="p">,</span><span class="w">  </span><span class="c1">// Saw: &gt;&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Periods
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">period</span><span class="p">,</span><span class="w">                             </span><span class="c1">// Saw: .
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">period_2</span><span class="p">,</span><span class="w">                           </span><span class="c1">// Saw: ..
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">period_asterisk</span><span class="p">,</span><span class="w">                    </span><span class="c1">// Saw: .*
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Special
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">saw_at_sign</span><span class="p">,</span><span class="w">                        </span><span class="c1">// Saw: @
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">invalid</span><span class="p">,</span><span class="w">                            </span><span class="c1">// Error recovery
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div>
<h2 class="relative group">Step-by-Step Example: Tokenizing <code>const</code>
    <div id="step-by-step-example-tokenizing-const" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#step-by-step-example-tokenizing-const" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>Let&rsquo;s trace through how <code>const x = 5;</code> gets tokenized:</p>
<pre tabindex="0"><code>Input: &#34;const x = 5;&#34;
        ^
        index = 0

Step 1: START state, see &#39;c&#39; (letter)
        ─────────────────────────────

        ┌─────┐     &#39;c&#39;      ┌────────────┐
        │START│ ───────────▶ │ IDENTIFIER │
        └─────┘              └────────────┘

        Set tag = .identifier
        Continue reading...

Step 2: IDENTIFIER state, see &#39;o&#39; (letter)
        ───────────────────────────────────

        &#34;const x = 5;&#34;
          ^
          index = 1

        ┌────────────┐  &#39;o&#39;  ┌────────────┐
        │ IDENTIFIER │ ────▶ │ IDENTIFIER │
        └────────────┘       └────────────┘

        Still in identifier, keep going...

Step 3-5: Keep reading &#39;n&#39;, &#39;s&#39;, &#39;t&#39;
        ─────────────────────────────

        &#34;const x = 5;&#34;
              ^
              index = 5

        Still identifier characters, stay in state

Step 6: IDENTIFIER state, see &#39; &#39; (space)
        ──────────────────────────────────

        &#34;const x = 5;&#34;
               ^
               index = 5

        Space is NOT an identifier character!

        ┌────────────┐  &#39; &#39;  ┌──────────────────┐
        │ IDENTIFIER │ ────▶ │ CHECK IF KEYWORD │
        └────────────┘       └──────────────────┘

        Extract text: source[0..5] = &#34;const&#34;
        Look up in keyword table: &#34;const&#34; → .keyword_const

        EMIT TOKEN: { .tag = .keyword_const, .loc = {0, 5} }
</code></pre>
<h3 class="relative group">Visual Token Extraction
    <div id="visual-token-extraction" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#visual-token-extraction" aria-label="Anchor">#</a>
    </span>
    
</h3>
<pre tabindex="0"><code>Source String:
┌───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┐
│ c │ o │ n │ s │ t │   │ x │   │ = │   │ 5 │ ; │
└───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┘
  0   1   2   3   4   5   6   7   8   9  10  11

Token 1: &#34;const&#34;
├───────────────────┤
start=0           end=5

Token 2: &#34;x&#34;
                    ├───┤
                  start=6 end=7

Token 3: &#34;=&#34;
                            ├───┤
                          start=8 end=9

Token 4: &#34;5&#34;
                                    ├────┤
                                  start=10 end=11

Token 5: &#34;;&#34;
                                         ├───┤
                                       start=11 end=12
</code></pre>
<h2 class="relative group">Identifier State Machine (Source Code Deep Dive)
    <div id="identifier-state-machine-source-code-deep-dive" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#identifier-state-machine-source-code-deep-dive" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>Let&rsquo;s look at the <strong>actual source code</strong> from <code>lib/std/zig/tokenizer.zig</code> that handles identifiers and keywords:</p>

<h3 class="relative group">Entry Point: START State (Lines 431-434)
    <div id="entry-point-start-state-lines-431-434" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#entry-point-start-state-lines-431-434" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>When the tokenizer sees a letter or underscore in the start state:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="c1">// In the START state switch:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="s">&#39;a&#39;</span><span class="p">...</span><span class="s">&#39;z&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;A&#39;</span><span class="p">...</span><span class="s">&#39;Z&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;_&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">identifier</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">continue</span><span class="w"> </span><span class="o">:</span><span class="n">state</span><span class="w"> </span><span class="p">.</span><span class="n">identifier</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">},</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>This immediately:</p>
<ol>
<li>Sets the token tag to <code>.identifier</code> (may be changed to keyword later)</li>
<li>Transitions to the <code>identifier</code> state</li>
</ol>

<h3 class="relative group">Identifier State Loop (Lines 664-675)
    <div id="identifier-state-loop-lines-664-675" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#identifier-state-loop-lines-664-675" aria-label="Anchor">#</a>
    </span>
    
</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="p">.</span><span class="n">identifier</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">buffer</span><span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#39;a&#39;</span><span class="p">...</span><span class="s">&#39;z&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;A&#39;</span><span class="p">...</span><span class="s">&#39;Z&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;0&#39;</span><span class="p">...</span><span class="s">&#39;9&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="o">:</span><span class="n">state</span><span class="w"> </span><span class="p">.</span><span class="n">identifier</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kr">const</span><span class="w"> </span><span class="n">ident</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">buffer</span><span class="p">[</span><span class="n">result</span><span class="p">.</span><span class="n">loc</span><span class="p">.</span><span class="n">start</span><span class="p">..</span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="p">];</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Token</span><span class="p">.</span><span class="nf">getKeyword</span><span class="p">(</span><span class="n">ident</span><span class="p">))</span><span class="w"> </span><span class="o">|</span><span class="n">tag</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">result</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tag</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">},</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Key observations:</p>
<ul>
<li><strong>Valid identifier characters</strong>: <code>a-z</code>, <code>A-Z</code>, <code>_</code>, <code>0-9</code> (but can&rsquo;t start with digit)</li>
<li><strong>Termination</strong>: Any other character ends the identifier</li>
<li><strong>Keyword lookup</strong>: After termination, checks if it&rsquo;s a keyword</li>
</ul>

<h3 class="relative group">Keyword Lookup: Compile-Time Perfect Hash (Lines 12-63)
    <div id="keyword-lookup-compile-time-perfect-hash-lines-12-63" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#keyword-lookup-compile-time-perfect-hash-lines-12-63" aria-label="Anchor">#</a>
    </span>
    
</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">getKeyword</span><span class="p">(</span><span class="n">bytes</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span><span class="kr">const</span><span class="w"> </span><span class="kt">u8</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="n">Tag</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">keywords</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">bytes</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">const</span><span class="w"> </span><span class="n">keywords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="nf">StaticStringMap</span><span class="p">(</span><span class="n">Tag</span><span class="p">).</span><span class="nf">initComptime</span><span class="p">(.{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.{</span><span class="w"> </span><span class="s">&#34;addrspace&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">keyword_addrspace</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.{</span><span class="w"> </span><span class="s">&#34;align&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">keyword_align</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.{</span><span class="w"> </span><span class="s">&#34;allowzero&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">keyword_allowzero</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.{</span><span class="w"> </span><span class="s">&#34;and&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">keyword_and</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.{</span><span class="w"> </span><span class="s">&#34;anyframe&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">keyword_anyframe</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.{</span><span class="w"> </span><span class="s">&#34;anytype&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">keyword_anytype</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.{</span><span class="w"> </span><span class="s">&#34;asm&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">keyword_asm</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.{</span><span class="w"> </span><span class="s">&#34;async&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">keyword_async</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.{</span><span class="w"> </span><span class="s">&#34;await&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">keyword_await</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.{</span><span class="w"> </span><span class="s">&#34;break&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">keyword_break</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.{</span><span class="w"> </span><span class="s">&#34;callconv&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">keyword_callconv</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.{</span><span class="w"> </span><span class="s">&#34;catch&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">keyword_catch</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.{</span><span class="w"> </span><span class="s">&#34;comptime&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">keyword_comptime</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">.{</span><span class="w"> </span><span class="s">&#34;const&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">keyword_const</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ... 45 more keywords ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">.{</span><span class="w"> </span><span class="s">&#34;while&#34;</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">keyword_while</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">});</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>StaticStringMap</code> creates a <strong>compile-time perfect hash table</strong> for O(1) keyword lookups!</p>

<h3 class="relative group">Visual State Machine
    <div id="visual-state-machine" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#visual-state-machine" aria-label="Anchor">#</a>
    </span>
    
</h3>
<pre tabindex="0"><code>                ┌─────────────────────────────────────────────────────────────┐
                │                    START STATE                               │
                │                                                              │
                │   See &#39;a&#39;-&#39;z&#39;, &#39;A&#39;-&#39;Z&#39;, &#39;_&#39;                                 │
                └─────────────────────────────────────────────────────────────┘
                                        │
                                        │ Set tag = .identifier
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           IDENTIFIER STATE                                       │
│                                                                                  │
│   ┌──────────────────────────────────────────────────────────────────────────┐  │
│   │                         LOOP HERE                                         │  │
│   │                                                                           │  │
│   │   See &#39;a&#39;-&#39;z&#39;, &#39;A&#39;-&#39;Z&#39;, &#39;_&#39;, &#39;0&#39;-&#39;9&#39;  ───▶  Stay in IDENTIFIER state     │  │
│   │                          │                                                │  │
│   │                          └─────────────────────────────────────────────┐  │  │
│   │                                                                        │  │  │
│   │   ┌────────────────────────────────────────────────────────────────────┘  │  │
│   │   │                                                                       │  │
│   │   ▼                                                                       │  │
│   │   ┌───┐  &#39;a&#39;-&#39;z&#39;    ┌───┐  &#39;A&#39;-&#39;Z&#39;    ┌───┐  &#39;_&#39;    ┌───┐  &#39;0&#39;-&#39;9&#39;       │  │
│   │   │ c │ ─────────▶  │ o │ ─────────▶  │ n │ ─────▶  │ s │ ─────────▶ ... │  │
│   │   └───┘             └───┘             └───┘         └───┘                 │  │
│   │                                                                           │  │
│   └───────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        │ See anything else (space, operator, etc.)
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           TERMINATION                                            │
│                                                                                  │
│   1. Extract text: buffer[start..index]                                         │
│                                                                                  │
│   2. Check keyword table:                                                        │
│      ┌──────────────────────────────────────────────────────────────────────┐   │
│      │                    StaticStringMap Lookup                             │   │
│      │                                                                       │   │
│      │   &#34;const&#34;  ──▶  .keyword_const     ✓                                 │   │
│      │   &#34;if&#34;     ──▶  .keyword_if        ✓                                 │   │
│      │   &#34;foo&#34;    ──▶  null (not keyword) ✗                                 │   │
│      │   &#34;myVar&#34;  ──▶  null (not keyword) ✗                                 │   │
│      └──────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
│   3. If keyword found: result.tag = keyword_tag                                 │
│      Else: result.tag stays .identifier                                         │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
                              EMIT TOKEN &amp; RETURN
</code></pre>
<h3 class="relative group">Example Trace: Tokenizing <code>const</code>
    <div id="example-trace-tokenizing-const" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#example-trace-tokenizing-const" aria-label="Anchor">#</a>
    </span>
    
</h3>
<pre tabindex="0"><code>Input: &#34;const x = 5&#34;
        ^
        index = 0

┌──────────────────────────────────────────────────────────────────────────────────┐
│ Step │ Index │ Char │ State      │ Action                         │ tag          │
├──────────────────────────────────────────────────────────────────────────────────┤
│  1   │   0   │ &#39;c&#39;  │ start      │ See letter, set tag            │ .identifier  │
│      │       │      │            │ → identifier state             │              │
├──────────────────────────────────────────────────────────────────────────────────┤
│  2   │   1   │ &#39;o&#39;  │ identifier │ index++, see letter            │ .identifier  │
│      │       │      │            │ continue :state .identifier    │              │
├──────────────────────────────────────────────────────────────────────────────────┤
│  3   │   2   │ &#39;n&#39;  │ identifier │ index++, see letter            │ .identifier  │
│      │       │      │            │ continue :state .identifier    │              │
├──────────────────────────────────────────────────────────────────────────────────┤
│  4   │   3   │ &#39;s&#39;  │ identifier │ index++, see letter            │ .identifier  │
│      │       │      │            │ continue :state .identifier    │              │
├──────────────────────────────────────────────────────────────────────────────────┤
│  5   │   4   │ &#39;t&#39;  │ identifier │ index++, see letter            │ .identifier  │
│      │       │      │            │ continue :state .identifier    │              │
├──────────────────────────────────────────────────────────────────────────────────┤
│  6   │   5   │ &#39; &#39;  │ identifier │ index++, see SPACE             │              │
│      │       │      │            │ NOT identifier char!           │              │
│      │       │      │            │                                │              │
│      │       │      │            │ Extract: buffer[0..5]=&#34;const&#34;  │              │
│      │       │      │            │                                │              │
│      │       │      │            │ Lookup: getKeyword(&#34;const&#34;)    │              │
│      │       │      │            │ Result: .keyword_const         │              │
│      │       │      │            │                                │              │
│      │       │      │            │ Set tag = .keyword_const       │.keyword_const│
├──────────────────────────────────────────────────────────────────────────────────┤
│      │       │      │            │ EMIT TOKEN                     │              │
│      │       │      │            │ { .tag = .keyword_const,       │              │
│      │       │      │            │   .loc = { 0, 5 } }            │              │
└──────────────────────────────────────────────────────────────────────────────────┘
</code></pre>
<h3 class="relative group">Valid vs Invalid Identifiers
    <div id="valid-vs-invalid-identifiers" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#valid-vs-invalid-identifiers" aria-label="Anchor">#</a>
    </span>
    
</h3>
<pre tabindex="0"><code>Valid Identifiers:
┌─────────────────┬────────────────────────────────────────────────────────────┐
│ foo             │ Simple lowercase                                           │
│ Bar             │ Capitalized (often types)                                  │
│ _private        │ Underscore prefix (convention: private/internal)           │
│ camelCase       │ Mixed case                                                 │
│ snake_case      │ Underscores                                                │
│ Point2D         │ Alphanumeric after first char                             │
│ __builtin       │ Double underscore (compiler internals)                     │
│ a               │ Single character                                           │
│ _               │ Single underscore                                          │
│ @&#34;while&#34;        │ Escaped keyword (quoted identifier) - special syntax       │
└─────────────────┴────────────────────────────────────────────────────────────┘

Invalid Identifiers (won&#39;t parse as identifier):
┌─────────────────┬────────────────────────────────────────────────────────────┐
│ 2fast           │ Can&#39;t start with digit → parsed as number then identifier │
│ my-var          │ Hyphen not allowed → parsed as my, minus, var             │
│ hello world     │ Space breaks it → two identifiers                         │
│ const           │ Keyword → .keyword_const (not .identifier)                │
└─────────────────┴────────────────────────────────────────────────────────────┘
</code></pre>
<h3 class="relative group">Escaped Identifiers: <code>@&quot;...&quot;</code> Syntax
    <div id="escaped-identifiers--syntax" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#escaped-identifiers--syntax" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>Zig has a special escape hatch for using reserved words as identifiers:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="c1">// This is a compile error:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">var</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">  </span><span class="c1">// &#34;while&#34; is a keyword!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// This works - escaped identifier:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">var</span><span class="w"> </span><span class="err">@</span><span class="s">&#34;while&#34;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">  </span><span class="c1">// @&#34;while&#34; is the identifier
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>This is handled by a separate state machine branch for <code>@&quot;...&quot;</code> syntax.</p>

<h2 class="relative group">Operator State Machines
    <div id="operator-state-machines" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#operator-state-machines" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>Operators are tricky because they can have multiple characters. Here&rsquo;s how <code>+</code> is handled:</p>

<h3 class="relative group">The Plus Operator Family
    <div id="the-plus-operator-family" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#the-plus-operator-family" aria-label="Anchor">#</a>
    </span>
    
</h3>
<pre tabindex="0"><code>                    ┌─────────────────────────────────────────┐
                    │              SAW &#39;+&#39;                     │
                    │                                          │
                    │   Could be:  +  +=  +%  +%=  +|  +|=     │
                    └─────────────────────────────────────────┘
                                        │
                    ┌───────────────────┼───────────────────┐
                    │                   │                   │
                    ▼                   ▼                   ▼
             ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
             │  See &#39;=&#39;    │     │  See &#39;%&#39;    │     │  See &#39;|&#39;    │
             │             │     │             │     │             │
             │  Emit +=    │     │  PLUS_PERC  │     │  PLUS_PIPE  │
             └─────────────┘     └─────────────┘     └─────────────┘
                                        │                   │
                                        ▼                   ▼
                                 ┌─────────────┐     ┌─────────────┐
                                 │  See &#39;=&#39;    │     │  See &#39;=&#39;    │
                                 │             │     │             │
                                 │  Emit +%=   │     │  Emit +|=   │
                                 └─────────────┘     └─────────────┘
                                        │                   │
                         ┌──────────────┴───────────────────┘
                         │  See anything else
                         ▼
                  ┌─────────────┐
                  │  Emit +%    │  (or +|)
                  │  or just +  │
                  └─────────────┘
</code></pre>
<h3 class="relative group">Code for Plus States
    <div id="code-for-plus-states" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#code-for-plus-states" aria-label="Anchor">#</a>
    </span>
    
</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="p">.</span><span class="n">plus</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">buffer</span><span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#39;=&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">result</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">plus_equal</span><span class="p">;</span><span class="w">      </span><span class="c1">// +=
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#39;%&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="o">:</span><span class="n">state</span><span class="w"> </span><span class="p">.</span><span class="n">plus_percent</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#39;|&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="o">:</span><span class="n">state</span><span class="w"> </span><span class="p">.</span><span class="n">plus_pipe</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#39;+&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">result</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">plus_plus</span><span class="p">;</span><span class="w">       </span><span class="c1">// ++
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">plus</span><span class="p">,</span><span class="w">        </span><span class="c1">// just +
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">.</span><span class="n">plus_percent</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">buffer</span><span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#39;=&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">result</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">plus_percent_equal</span><span class="p">;</span><span class="w">  </span><span class="c1">// +%=
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">plus_percent</span><span class="p">,</span><span class="w">    </span><span class="c1">// +%
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">.</span><span class="n">plus_pipe</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">buffer</span><span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s">&#39;=&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">result</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">plus_pipe_equal</span><span class="p">;</span><span class="w">     </span><span class="c1">// +|=
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">plus_pipe</span><span class="p">,</span><span class="w">       </span><span class="c1">// +|
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">},</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div>
<h2 class="relative group">String Literal State Machine
    <div id="string-literal-state-machine" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#string-literal-state-machine" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>Strings have their own mini state machine to handle escape sequences:</p>
<pre tabindex="0"><code>                         ┌─────────────────────────────────────┐
                         │            SAW &#39;&#34;&#39;                   │
                         │                                      │
                         │     Enter STRING_LITERAL state       │
                         └─────────────────────────────────────┘
                                          │
                                          ▼
┌───────────────────────────────────────────────────────────────────────────────┐
│                           STRING_LITERAL STATE                                 │
│                                                                                │
│   ┌──────────────┐    ┌──────────────┐    ┌──────────────┐    ┌────────────┐  │
│   │  See &#39;\\&#39;    │    │  See &#39;&#34;&#39;     │    │  See &#39;\n&#39;    │    │  See other │  │
│   │              │    │              │    │              │    │            │  │
│   │  Go to       │    │  END STRING  │    │  ERROR!      │    │  Stay in   │  │
│   │  BACKSLASH   │    │  Emit token  │    │  No newlines │    │  state     │  │
│   └──────────────┘    └──────────────┘    └──────────────┘    └────────────┘  │
│          │                                                           │         │
│          ▼                                                           │         │
│   ┌──────────────────────────────────────────────────────────────────┘         │
│   │  STRING_LITERAL_BACKSLASH STATE                                            │
│   │                                                                            │
│   │  Valid escapes: \n \r \t \\ \&#34; \&#39; \x.. \u{..}                              │
│   │                                                                            │
│   │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐                        │
│   │  │ See &#39;n&#39; │  │ See &#39;x&#39; │  │ See &#39;u&#39; │  │ Other   │                        │
│   │  │ \n      │  │ \xNN    │  │ \u{...} │  │ ERROR   │                        │
│   │  └─────────┘  └─────────┘  └─────────┘  └─────────┘                        │
│   │       │            │            │                                          │
│   │       └────────────┴────────────┴──────────▶ Back to STRING_LITERAL        │
│   └────────────────────────────────────────────────────────────────────────────┘
└────────────────────────────────────────────────────────────────────────────────┘
</code></pre>
<h3 class="relative group">Example: Tokenizing <code>&quot;hello\nworld&quot;</code>
    <div id="example-tokenizing-hellonworld" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#example-tokenizing-hellonworld" aria-label="Anchor">#</a>
    </span>
    
</h3>
<pre tabindex="0"><code>Input: &#34;hello\nworld&#34;

Step 1: See &#39;&#34;&#39; → Enter STRING_LITERAL
        &#34;hello\nworld&#34;
         ^

Step 2-6: See &#39;h&#39;,&#39;e&#39;,&#39;l&#39;,&#39;l&#39;,&#39;o&#39; → Stay in STRING_LITERAL
          &#34;hello\nworld&#34;
               ^

Step 7: See &#39;\\&#39; → Go to STRING_LITERAL_BACKSLASH
        &#34;hello\nworld&#34;
              ^

Step 8: See &#39;n&#39; → Valid escape! Back to STRING_LITERAL
        &#34;hello\nworld&#34;
               ^

Step 9-13: See &#39;w&#39;,&#39;o&#39;,&#39;r&#39;,&#39;l&#39;,&#39;d&#39; → Stay in STRING_LITERAL
           &#34;hello\nworld&#34;
                      ^

Step 14: See &#39;&#34;&#39; → END! Emit string_literal token
         &#34;hello\nworld&#34;
                      ^

Result: Token { .tag = .string_literal, .loc = { 0, 14 } }
</code></pre>
<h2 class="relative group">Number Parsing State Machine
    <div id="number-parsing-state-machine" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#number-parsing-state-machine" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>Numbers are complex because of all the formats:</p>
<pre tabindex="0"><code>┌─────────────────────────────────────────────────────────────────────────────┐
│                         NUMBER PARSING                                       │
│                                                                              │
│   Start: See &#39;0&#39;-&#39;9&#39;                                                         │
│                                                                              │
│   ┌─────────┐                                                                │
│   │   INT   │◀────────────────────────────────────────────────────────┐      │
│   └─────────┘                                                         │      │
│        │                                                              │      │
│        ├──── See &#39;0&#39;-&#39;9&#39;, &#39;_&#39; ─────────────────────────────────────────┘      │
│        │     (continue reading digits)                                       │
│        │                                                                     │
│        ├──── See &#39;.&#39; ──────────────────▶ ┌─────────────┐                     │
│        │                                 │ INT_PERIOD  │                     │
│        │                                 └─────────────┘                     │
│        │                                        │                            │
│        │                                        ├─── See &#39;0&#39;-&#39;9&#39; ──▶ FLOAT   │
│        │                                        │                            │
│        │                                        └─── See &#39;.&#39; ──▶ &#39;..&#39; token  │
│        │                                             (not a float!)          │
│        │                                                                     │
│        ├──── See &#39;e&#39;,&#39;E&#39; ──────────────▶ ┌─────────────┐                     │
│        │     (exponent)                  │INT_EXPONENT │                     │
│        │                                 └─────────────┘                     │
│        │                                        │                            │
│        │                                        └─── See &#39;+&#39;,&#39;-&#39; ──▶ FLOAT   │
│        │                                                                     │
│        ├──── See &#39;b&#39; ──────────────────▶ Binary: 0b1010                      │
│        │     (after 0)                                                       │
│        │                                                                     │
│        ├──── See &#39;o&#39; ──────────────────▶ Octal: 0o755                        │
│        │     (after 0)                                                       │
│        │                                                                     │
│        └──── See &#39;x&#39; ──────────────────▶ Hex: 0xFF                           │
│              (after 0)                                                       │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
</code></pre>
<h3 class="relative group">Number Examples
    <div id="number-examples" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#number-examples" aria-label="Anchor">#</a>
    </span>
    
</h3>
<pre tabindex="0"><code>Decimal:     42         → .number_literal
             1_000_000  → .number_literal (underscores allowed!)

Binary:      0b1010     → .number_literal
             0b1111_0000→ .number_literal

Octal:       0o755      → .number_literal

Hex:         0xFF       → .number_literal
             0xDEAD_BEEF→ .number_literal

Float:       3.14       → .number_literal
             1.0e-10    → .number_literal
             0x1.0p10   → .number_literal (hex float!)
</code></pre>
<h2 class="relative group">Comment State Machine
    <div id="comment-state-machine" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#comment-state-machine" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>Comments have a decision tree for the different types:</p>
<pre tabindex="0"><code>             ┌─────────────────────────────────────────┐
             │              SAW &#39;/&#39;                     │
             └─────────────────────────────────────────┘
                              │
              ┌───────────────┼───────────────┐
              │               │               │
              ▼               ▼               ▼
       ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
       │  See &#39;/&#39;    │ │  See &#39;=&#39;    │ │  See other  │
       │             │ │             │ │             │
       │  COMMENT!   │ │  Emit /=    │ │  Emit /     │
       └─────────────┘ └─────────────┘ └─────────────┘
              │
              ▼
       ┌─────────────────────────────────────────────┐
       │          LINE_COMMENT_START                  │
       │                                              │
       │  What kind of comment?                       │
       └─────────────────────────────────────────────┘
              │
              ├──── See &#39;!&#39; ──────▶ //! Container doc comment
              │                     (module-level docs)
              │
              ├──── See &#39;/&#39; ──────▶ Maybe /// doc comment?
              │                            │
              │                            ├── See &#39;/&#39; ──▶ //// Regular comment
              │                            │               (too many slashes)
              │                            │
              │                            └── Other ──▶ /// Doc comment
              │                                          (for declarations)
              │
              └──── Other ────────▶ // Regular comment
                                    (skip until newline)
</code></pre>
<h3 class="relative group">Comment Examples
    <div id="comment-examples" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#comment-examples" aria-label="Anchor">#</a>
    </span>
    
</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="c1">// Regular comment           → Skipped entirely (no token)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">/// Documentation comment    → .doc_comment
</span></span></span><span class="line"><span class="cl"><span class="c1">/// for the next item
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//! Module-level docs        → .container_doc_comment
</span></span></span><span class="line"><span class="cl"><span class="c1">//! Describes the file
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//// Too many slashes        → Regular comment (skipped)
</span></span></span></code></pre></td></tr></table>
</div>
</div>
<h2 class="relative group">Token Types Reference
    <div id="token-types-reference" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#token-types-reference" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>Zig has 185 token types. Here are the categories:</p>

<h3 class="relative group">Literals
    <div id="literals" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#literals" aria-label="Anchor">#</a>
    </span>
    
</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="p">.</span><span class="n">identifier</span><span class="w">              </span><span class="c1">// foo, Bar, _internal
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">.</span><span class="n">string_literal</span><span class="w">          </span><span class="c1">// &#34;hello&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">.</span><span class="n">multiline_string_literal_line</span><span class="w">  </span><span class="c1">// \\multiline string
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">.</span><span class="n">char_literal</span><span class="w">            </span><span class="c1">// &#39;x&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">.</span><span class="n">number_literal</span><span class="w">          </span><span class="c1">// 42, 0xFF, 3.14
</span></span></span></code></pre></td></tr></table>
</div>
</div>
<h3 class="relative group">Operators (showing state machine complexity)
    <div id="operators-showing-state-machine-complexity" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#operators-showing-state-machine-complexity" aria-label="Anchor">#</a>
    </span>
    
</h3>
<pre tabindex="0"><code>Single char:    +  -  *  /  =  !  &lt;  &gt;  &amp;  |  ^  %  ~
                │  │  │  │  │  │  │  │  │  │  │  │  │
                │  │  │  │  │  │  │  │  │  │  │  │  └── ~  (bit not)
                │  │  │  │  │  │  │  │  │  │  │  │
                │  │  │  │  │  │  │  │  │  │  │  └───── %  %=
                │  │  │  │  │  │  │  │  │  │  │
                │  │  │  │  │  │  │  │  │  │  └──────── ^  ^=
                │  │  │  │  │  │  │  │  │  │
                │  │  │  │  │  │  │  │  │  └─────────── |  |=  ||
                │  │  │  │  │  │  │  │  │
                │  │  │  │  │  │  │  │  └──────────────&amp;  &amp;=
                │  │  │  │  │  │  │  │
                │  │  │  │  │  │  │  └─────────────────&gt;  &gt;=  &gt;&gt;  &gt;&gt;=
                │  │  │  │  │  │  │
                │  │  │  │  │  │  └────────────────────&lt;  &lt;=  &lt;&lt;  &lt;&lt;=  &lt;&lt;|  &lt;&lt;|=
                │  │  │  │  │  │
                │  │  │  │  │  └───────────────────────!  !=
                │  │  │  │  │
                │  │  │  │  └──────────────────────────=  ==  =&gt;
                │  │  │  │
                │  │  │  └─────────────────────────────/  /=  // (comment)
                │  │  │
                │  │  └────────────────────────────────*  *=  *%  *%=  *|  *|=  **
                │  │
                │  └───────────────────────────────────-  -=  -%  -%=  -|  -|=
                │
                └──────────────────────────────────────+  +=  +%  +%=  +|  +|=  ++
</code></pre>
<h3 class="relative group">Keywords (59 total)
    <div id="keywords-59-total" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#keywords-59-total" aria-label="Anchor">#</a>
    </span>
    
</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="c1">// Control flow
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">,</span><span class="w"> </span><span class="k">else</span><span class="p">,</span><span class="w"> </span><span class="k">switch</span><span class="p">,</span><span class="w"> </span><span class="k">while</span><span class="p">,</span><span class="w"> </span><span class="k">for</span><span class="p">,</span><span class="w"> </span><span class="k">break</span><span class="p">,</span><span class="w"> </span><span class="k">continue</span><span class="p">,</span><span class="w"> </span><span class="k">return</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Declarations
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span><span class="p">,</span><span class="w"> </span><span class="kr">var</span><span class="p">,</span><span class="w"> </span><span class="k">fn</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="p">,</span><span class="w"> </span><span class="k">enum</span><span class="p">,</span><span class="w"> </span><span class="k">union</span><span class="p">,</span><span class="w"> </span><span class="n">opaque</span><span class="p">,</span><span class="w"> </span><span class="k">test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Error handling
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">try</span><span class="p">,</span><span class="w"> </span><span class="k">catch</span><span class="p">,</span><span class="w"> </span><span class="k">error</span><span class="p">,</span><span class="w"> </span><span class="k">errdefer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Memory
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">defer</span><span class="p">,</span><span class="w"> </span><span class="kr">comptime</span><span class="p">,</span><span class="w"> </span><span class="kr">inline</span><span class="p">,</span><span class="w"> </span><span class="kr">noalias</span><span class="p">,</span><span class="w"> </span><span class="kr">volatile</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Types
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">anytype</span><span class="p">,</span><span class="w"> </span><span class="n">anyframe</span><span class="p">,</span><span class="w"> </span><span class="kt">type</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Boolean/logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">and</span><span class="p">,</span><span class="w"> </span><span class="k">or</span><span class="p">,</span><span class="w"> </span><span class="k">orelse</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Special
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">pub</span><span class="p">,</span><span class="w"> </span><span class="kr">extern</span><span class="p">,</span><span class="w"> </span><span class="kr">export</span><span class="p">,</span><span class="w"> </span><span class="kr">align</span><span class="p">,</span><span class="w"> </span><span class="kr">packed</span><span class="p">,</span><span class="w"> </span><span class="kr">threadlocal</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kr">linksection</span><span class="p">,</span><span class="w"> </span><span class="n">callconv</span><span class="p">,</span><span class="w"> </span><span class="n">addrspace</span><span class="p">,</span><span class="w"> </span><span class="kr">allowzero</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">suspend</span><span class="p">,</span><span class="w"> </span><span class="k">resume</span><span class="p">,</span><span class="w"> </span><span class="n">nosuspend</span><span class="p">,</span><span class="w"> </span><span class="k">unreachable</span><span class="p">,</span><span class="w"> </span><span class="kc">undefined</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="k">asm</span><span class="p">,</span><span class="w"> </span><span class="n">noinline</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div>
<h2 class="relative group">The Tokenizer Structure
    <div id="the-tokenizer-structure" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#the-tokenizer-structure" aria-label="Anchor">#</a>
    </span>
    
</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">pub</span><span class="w"> </span><span class="kr">const</span><span class="w"> </span><span class="n">Tokenizer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">buffer</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span><span class="kr">const</span><span class="w"> </span><span class="kt">u8</span><span class="p">,</span><span class="w">  </span><span class="c1">// Null-terminated source code
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">index</span><span class="o">:</span><span class="w"> </span><span class="kt">usize</span><span class="p">,</span><span class="w">          </span><span class="c1">// Current position
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kr">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">init</span><span class="p">(</span><span class="n">buffer</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span><span class="kr">const</span><span class="w"> </span><span class="kt">u8</span><span class="p">)</span><span class="w"> </span><span class="n">Tokenizer</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Skip UTF-8 BOM if present
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">.{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="p">.</span><span class="n">mem</span><span class="p">.</span><span class="nf">startsWith</span><span class="p">(</span><span class="kt">u8</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;</span><span class="se">\xEF\xBB\xBF</span><span class="s">&#34;</span><span class="p">))</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">};</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Note that the source must be null-terminated (<code>[:0]const u8</code>). This allows the tokenizer to detect end-of-file without bounds checking.</p>

<h2 class="relative group">The Main Tokenization Loop
    <div id="the-main-tokenization-loop" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#the-main-tokenization-loop" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>The <code>next()</code> function is the heart of the tokenizer:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">next</span><span class="p">(</span><span class="n">self</span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">Tokenizer</span><span class="p">)</span><span class="w"> </span><span class="n">Token</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kr">var</span><span class="w"> </span><span class="n">result</span><span class="o">:</span><span class="w"> </span><span class="n">Token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">undefined</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="n">loc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">undefined</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">state</span><span class="o">:</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">start</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="n">start</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">buffer</span><span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="mi">0</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// End of file
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">buffer</span><span class="p">.</span><span class="n">len</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="p">.{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">eof</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="n">loc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.{</span><span class="w"> </span><span class="p">.</span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="c1">// Null byte in middle of file
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">                    </span><span class="k">continue</span><span class="w"> </span><span class="o">:</span><span class="n">state</span><span class="w"> </span><span class="p">.</span><span class="n">invalid</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Skip whitespace
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">            </span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="w"> </span><span class="se">&#39;\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="se">&#39;\t&#39;</span><span class="p">,</span><span class="w"> </span><span class="se">&#39;\r&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">result</span><span class="p">.</span><span class="n">loc</span><span class="p">.</span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">continue</span><span class="w"> </span><span class="o">:</span><span class="n">state</span><span class="w"> </span><span class="p">.</span><span class="n">start</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// String literal
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">            </span><span class="s">&#39;&#34;&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">result</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">string_literal</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">continue</span><span class="w"> </span><span class="o">:</span><span class="n">state</span><span class="w"> </span><span class="p">.</span><span class="n">string_literal</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Identifier or keyword
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">            </span><span class="s">&#39;a&#39;</span><span class="p">...</span><span class="s">&#39;z&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;A&#39;</span><span class="p">...</span><span class="s">&#39;Z&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;_&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">result</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">identifier</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">continue</span><span class="w"> </span><span class="o">:</span><span class="n">state</span><span class="w"> </span><span class="p">.</span><span class="n">identifier</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Operators
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">            </span><span class="s">&#39;+&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="o">:</span><span class="n">state</span><span class="w"> </span><span class="p">.</span><span class="n">plus</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="s">&#39;-&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="o">:</span><span class="n">state</span><span class="w"> </span><span class="p">.</span><span class="n">minus</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="s">&#39;*&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="o">:</span><span class="n">state</span><span class="w"> </span><span class="p">.</span><span class="n">asterisk</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="s">&#39;/&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="o">:</span><span class="n">state</span><span class="w"> </span><span class="p">.</span><span class="n">slash</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// ... more cases
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ... more states
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="n">loc</span><span class="p">.</span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>continue :state</code> construct is Zig&rsquo;s <strong>labeled switch continue</strong>, which efficiently jumps to another state without function call overhead.</p>

<h2 class="relative group">Full Tokenization Example
    <div id="full-tokenization-example" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#full-tokenization-example" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>Let&rsquo;s trace the complete tokenization of a simple statement:</p>
<pre tabindex="0"><code>Input: &#34;var x: i32 = -5;&#34;

┌─────────────────────────────────────────────────────────────────────────────┐
│ Step │ Char │ State          │ Action                    │ Token Emitted    │
├─────────────────────────────────────────────────────────────────────────────┤
│  1   │ &#39;v&#39;  │ start          │ → identifier              │                  │
│  2   │ &#39;a&#39;  │ identifier     │ continue                  │                  │
│  3   │ &#39;r&#39;  │ identifier     │ continue                  │                  │
│  4   │ &#39; &#39;  │ identifier     │ check keyword → YES       │ .keyword_var     │
├─────────────────────────────────────────────────────────────────────────────┤
│  5   │ &#39; &#39;  │ start          │ skip whitespace           │                  │
│  6   │ &#39;x&#39;  │ start          │ → identifier              │                  │
│  7   │ &#39;:&#39;  │ identifier     │ emit, not keyword         │ .identifier      │
├─────────────────────────────────────────────────────────────────────────────┤
│  8   │ &#39;:&#39;  │ start          │ single char token         │ .colon           │
├─────────────────────────────────────────────────────────────────────────────┤
│  9   │ &#39; &#39;  │ start          │ skip whitespace           │                  │
│ 10   │ &#39;i&#39;  │ start          │ → identifier              │                  │
│ 11   │ &#39;3&#39;  │ identifier     │ continue                  │                  │
│ 12   │ &#39;2&#39;  │ identifier     │ continue                  │                  │
│ 13   │ &#39; &#39;  │ identifier     │ emit, not keyword         │ .identifier      │
├─────────────────────────────────────────────────────────────────────────────┤
│ 14   │ &#39; &#39;  │ start          │ skip whitespace           │                  │
│ 15   │ &#39;=&#39;  │ start          │ → equal state             │                  │
│ 16   │ &#39; &#39;  │ equal          │ not &#39;=&#39;, emit             │ .equal           │
├─────────────────────────────────────────────────────────────────────────────┤
│ 17   │ &#39; &#39;  │ start          │ skip whitespace           │                  │
│ 18   │ &#39;-&#39;  │ start          │ → minus state             │                  │
│ 19   │ &#39;5&#39;  │ minus          │ not &#39;-=%|&#39;, emit          │ .minus           │
├─────────────────────────────────────────────────────────────────────────────┤
│ 20   │ &#39;5&#39;  │ start          │ → int state               │                  │
│ 21   │ &#39;;&#39;  │ int            │ emit number               │ .number_literal  │
├─────────────────────────────────────────────────────────────────────────────┤
│ 22   │ &#39;;&#39;  │ start          │ single char token         │ .semicolon       │
├─────────────────────────────────────────────────────────────────────────────┤
│ 23   │ EOF  │ start          │ end of input              │ .eof             │
└─────────────────────────────────────────────────────────────────────────────┘

Final token stream:
[.keyword_var] [.identifier] [.colon] [.identifier] [.equal] [.minus] [.number_literal] [.semicolon] [.eof]
     &#34;var&#34;          &#34;x&#34;         &#34;:&#34;       &#34;i32&#34;        &#34;=&#34;       &#34;-&#34;         &#34;5&#34;            &#34;;&#34;
</code></pre>
<h2 class="relative group">Error Recovery and Invalid Tokens (Deep Dive)
    <div id="error-recovery-and-invalid-tokens-deep-dive" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#error-recovery-and-invalid-tokens-deep-dive" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>The tokenizer must handle malformed input gracefully. Instead of crashing, it produces <code>.invalid</code> tokens and continues parsing. This allows the compiler to report multiple errors in one pass.</p>

<h3 class="relative group">What Causes Invalid Tokens?
    <div id="what-causes-invalid-tokens" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#what-causes-invalid-tokens" aria-label="Anchor">#</a>
    </span>
    
</h3>
<pre tabindex="0"><code>┌─────────────────────────────────────────────────────────────────────────────┐
│                    CAUSES OF INVALID TOKENS                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  1. ILLEGAL CHARACTERS                                                       │
│     ───────────────────                                                      │
│     #  `  $  ~  etc.        Characters not in Zig&#39;s grammar                 │
│                                                                              │
│  2. NULL BYTES IN SOURCE                                                     │
│     ────────────────────                                                     │
│     &#34;hello\x00world&#34;        Null byte in middle of file                     │
│                             (valid only at EOF)                             │
│                                                                              │
│  3. UNTERMINATED STRINGS                                                     │
│     ────────────────────                                                     │
│     &#34;hello                  String that never closes                        │
│     &#34;hello\                 Escape at end of string                         │
│     &#34;hello                  Newline in string literal                       │
│     world&#34;                                                                  │
│                                                                              │
│  4. UNTERMINATED CHAR LITERALS                                              │
│     ──────────────────────────                                               │
│     &#39;c                      Missing closing quote                           │
│     &#39;                       Empty char literal start                        │
│     &#39;\                      Escape at end                                   │
│                                                                              │
│  5. INVALID ESCAPE SEQUENCES                                                │
│     ────────────────────────                                                 │
│     &#34;\q&#34;                    Invalid escape char                             │
│     &#39;\u&#39;                    Incomplete unicode escape                       │
│                                                                              │
│  6. CONTROL CHARACTERS                                                       │
│     ──────────────────                                                       │
│     0x00-0x1F               Control chars in strings/comments               │
│     0x7F (DEL)              Delete character                                │
│                                                                              │
│  7. INVALID TAB/CR PLACEMENT                                                │
│     ────────────────────────                                                 │
│     //\t comment            Tab in comment (ambiguous rendering)            │
│     // text\r               Bare CR (not followed by \n)                    │
│                                                                              │
│  8. INVALID @ SEQUENCES                                                      │
│     ───────────────────                                                      │
│     @()                     @ not followed by identifier or &#34;               │
│     @0abc                   @ followed by digit                             │
│                                                                              │
│  9. INVALID OPERATOR SEQUENCES                                              │
│     ──────────────────────────                                               │
│     .**                     Period-asterisk-asterisk is invalid             │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
</code></pre>
<h3 class="relative group">The Invalid State (Actual Source Code)
    <div id="the-invalid-state-actual-source-code" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#the-invalid-state-actual-source-code" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>Here&rsquo;s the actual code from <code>lib/std/zig/tokenizer.zig</code> that handles invalid tokens:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="p">.</span><span class="n">invalid</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">buffer</span><span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="mi">0</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">buffer</span><span class="p">.</span><span class="n">len</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">result</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">invalid</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">continue</span><span class="w"> </span><span class="o">:</span><span class="n">state</span><span class="w"> </span><span class="p">.</span><span class="n">invalid</span><span class="p">;</span><span class="w">  </span><span class="c1">// Null in middle of file
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="se">&#39;\n&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">invalid</span><span class="p">,</span><span class="w">  </span><span class="c1">// Newline ends invalid token
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="o">:</span><span class="n">state</span><span class="w"> </span><span class="p">.</span><span class="n">invalid</span><span class="p">,</span><span class="w">  </span><span class="c1">// Keep consuming bad chars
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">},</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Key insight: <strong>Invalid tokens extend until a newline or EOF</strong>. This groups related errors together.</p>

<h3 class="relative group">How Different Errors Enter Invalid State
    <div id="how-different-errors-enter-invalid-state" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#how-different-errors-enter-invalid-state" aria-label="Anchor">#</a>
    </span>
    
</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="c1">// From START state - illegal character
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">.</span><span class="n">start</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">buffer</span><span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ... valid cases ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="o">:</span><span class="n">state</span><span class="w"> </span><span class="p">.</span><span class="n">invalid</span><span class="p">,</span><span class="w">  </span><span class="c1">// Unknown char → invalid
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// From SAW_AT_SIGN - @ not followed by valid sequence
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">.</span><span class="n">saw_at_sign</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">buffer</span><span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="se">&#39;\n&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">invalid</span><span class="p">,</span><span class="w">           </span><span class="c1">// @ at EOL
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="s">&#39;&#34;&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">/*</span><span class="w"> </span><span class="n">valid</span><span class="o">:</span><span class="w"> </span><span class="err">@</span><span class="s">&#34;identifier&#34;</span><span class="w"> </span><span class="o">*/</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#39;a&#39;</span><span class="p">...</span><span class="s">&#39;z&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;A&#39;</span><span class="p">...</span><span class="s">&#39;Z&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;_&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">/*</span><span class="w"> </span><span class="n">valid</span><span class="o">:</span><span class="w"> </span><span class="nb">@builtin</span><span class="w"> </span><span class="o">*/</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="o">:</span><span class="n">state</span><span class="w"> </span><span class="p">.</span><span class="n">invalid</span><span class="p">,</span><span class="w">           </span><span class="c1">// @# or @0 etc.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// From STRING_LITERAL - problematic content
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">.</span><span class="n">string_literal</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">buffer</span><span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">0</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">buffer</span><span class="p">.</span><span class="n">len</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">continue</span><span class="w"> </span><span class="o">:</span><span class="n">state</span><span class="w"> </span><span class="p">.</span><span class="n">invalid</span><span class="p">;</span><span class="w">  </span><span class="c1">// Null byte in string
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">result</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">invalid</span><span class="p">;</span><span class="w">     </span><span class="c1">// Unterminated string at EOF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="se">&#39;\n&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">invalid</span><span class="p">,</span><span class="w">     </span><span class="c1">// Newline in string = error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="mh">0x01</span><span class="p">...</span><span class="mh">0x09</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0b</span><span class="p">...</span><span class="mh">0x1f</span><span class="p">,</span><span class="w"> </span><span class="mh">0x7f</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">continue</span><span class="w"> </span><span class="o">:</span><span class="n">state</span><span class="w"> </span><span class="p">.</span><span class="n">invalid</span><span class="p">;</span><span class="w">       </span><span class="c1">// Control characters
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ... valid cases ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// From BACKSLASH - single \ not followed by valid escape start
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">.</span><span class="n">backslash</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">buffer</span><span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">0</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">invalid</span><span class="p">,</span><span class="w">         </span><span class="c1">// \ at EOF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="se">&#39;\\&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">/*</span><span class="w"> </span><span class="n">valid</span><span class="o">:</span><span class="w"> </span><span class="n">multiline</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="sh">\\ */ },</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="se">&#39;\n&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">invalid</span><span class="p">,</span><span class="w">      </span><span class="c1">// \ then newline
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="o">:</span><span class="n">state</span><span class="w"> </span><span class="p">.</span><span class="n">invalid</span><span class="p">,</span><span class="w">   </span><span class="c1">// \ followed by invalid
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">},</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div>
<h3 class="relative group">Visual Invalid Token State Machine
    <div id="visual-invalid-token-state-machine" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#visual-invalid-token-state-machine" aria-label="Anchor">#</a>
    </span>
    
</h3>
<pre tabindex="0"><code>┌─────────────────────────────────────────────────────────────────────────────┐
│                    INVALID TOKEN STATE MACHINE                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│                          ENTRY POINTS                                        │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │
│  │   Unknown    │  │  Null byte   │  │  Control     │  │  Invalid @   │     │
│  │   character  │  │  in source   │  │  character   │  │  sequence    │     │
│  │   (#, `, $)  │  │  (\x00)      │  │  (0x01-0x1f) │  │  (@0, @#)    │     │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘     │
│         │                 │                 │                 │              │
│         └─────────────────┴─────────────────┴─────────────────┘              │
│                                    │                                         │
│                                    ▼                                         │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                         INVALID STATE                                  │  │
│  │                                                                        │  │
│  │   ┌────────────────────────────────────────────────────────────────┐  │  │
│  │   │                     CONSUME LOOP                                │  │  │
│  │   │                                                                 │  │  │
│  │   │   See any character except &#39;\n&#39; or &#39;\0&#39; at EOF                 │  │  │
│  │   │            │                                                    │  │  │
│  │   │            ▼                                                    │  │  │
│  │   │   index++, continue :state .invalid                            │  │  │
│  │   │            │                                                    │  │  │
│  │   │            └──────────────────────────────────┐                │  │  │
│  │   │                                               │                │  │  │
│  │   │   ┌─────────────────────────────────────────────────────────┐  │  │  │
│  │   │   │  KEEP CONSUMING until we see:                           │  │  │  │
│  │   │   │                                                         │  │  │  │
│  │   │   │    &#39;#&#39; &#39;$&#39; &#39;@&#39; &#39;!&#39; &#39;%&#39; ...  ◀── Keep going             │  │  │  │
│  │   │   │                                                         │  │  │  │
│  │   └───┴─────────────────────────────────────────────────────────┘  │  │
│  │                                                                        │  │
│  └────────────────────────────────────────────────────────────────────────┘  │
│                                    │                                         │
│              ┌─────────────────────┴─────────────────────┐                   │
│              │                                           │                   │
│              ▼                                           ▼                   │
│  ┌──────────────────────────┐             ┌──────────────────────────┐      │
│  │     See &#39;\n&#39; (newline)   │             │    See &#39;\0&#39; at EOF       │      │
│  │                          │             │                          │      │
│  │  result.tag = .invalid   │             │  result.tag = .invalid   │      │
│  │  EMIT TOKEN &amp; RETURN     │             │  EMIT TOKEN &amp; RETURN     │      │
│  │                          │             │                          │      │
│  │  Ready for next token    │             │  Parser sees .invalid    │      │
│  │  on new line             │             │  then .eof               │      │
│  └──────────────────────────┘             └──────────────────────────┘      │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
</code></pre>
<h3 class="relative group">Example 1: Illegal Character
    <div id="example-1-illegal-character" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#example-1-illegal-character" aria-label="Anchor">#</a>
    </span>
    
</h3>
<pre tabindex="0"><code>Input: &#34;const #bad = 5;&#34;
              ^
              illegal char &#39;#&#39;

┌──────────────────────────────────────────────────────────────────────────────────┐
│ Index │ Char │ State      │ Action                                │ Result       │
├──────────────────────────────────────────────────────────────────────────────────┤
│   0   │ &#39;c&#39;  │ start      │ → identifier                          │              │
│   5   │ &#39; &#39;  │ identifier │ emit &#34;const&#34;                          │ keyword_const│
│   6   │ &#39;#&#39;  │ start      │ Unknown char! → invalid                │              │
│   7   │ &#39;b&#39;  │ invalid    │ Not &#39;\n&#39; or EOF, continue              │              │
│   8   │ &#39;a&#39;  │ invalid    │ Not &#39;\n&#39; or EOF, continue              │              │
│   9   │ &#39;d&#39;  │ invalid    │ Not &#39;\n&#39; or EOF, continue              │              │
│  10   │ &#39; &#39;  │ invalid    │ Not &#39;\n&#39; or EOF, continue              │              │
│  11   │ &#39;=&#39;  │ invalid    │ Not &#39;\n&#39; or EOF, continue              │              │
│  12   │ &#39; &#39;  │ invalid    │ Not &#39;\n&#39; or EOF, continue              │              │
│  13   │ &#39;5&#39;  │ invalid    │ Not &#39;\n&#39; or EOF, continue              │              │
│  14   │ &#39;;&#39;  │ invalid    │ Not &#39;\n&#39; or EOF, continue              │              │
│  15   │ EOF  │ invalid    │ At EOF! Emit invalid token             │ .invalid     │
├──────────────────────────────────────────────────────────────────────────────────┤
│ Token Stream: [.keyword_const] [.invalid]                                        │
│                    &#34;const&#34;       &#34;#bad = 5;&#34;                                     │
│                                                                                  │
│ Note: The ENTIRE rest of the line became one invalid token!                      │
└──────────────────────────────────────────────────────────────────────────────────┘
</code></pre>
<h3 class="relative group">Example 2: Unterminated String
    <div id="example-2-unterminated-string" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#example-2-unterminated-string" aria-label="Anchor">#</a>
    </span>
    
</h3>
<pre tabindex="0"><code>Input: &#34;const s = &#34;hello
        var x = 5;&#34;
                    ^
                    newline inside string

┌──────────────────────────────────────────────────────────────────────────────────┐
│ Index │ Char │ State          │ Action                          │ Result         │
├──────────────────────────────────────────────────────────────────────────────────┤
│   0   │ &#39;c&#39;  │ start          │ → identifier                    │                │
│  ...  │      │                │                                 │ keyword_const  │
│   8   │ &#39;=&#39;  │ start          │ → equal                         │ .equal         │
│  10   │ &#39;&#34;&#39;  │ start          │ → string_literal                │                │
│  11   │ &#39;h&#39;  │ string_literal │ continue                        │                │
│  ...  │      │                │                                 │                │
│  16   │ &#39;\n&#39; │ string_literal │ NEWLINE IN STRING! → .invalid   │ .invalid       │
├──────────────────────────────────────────────────────────────────────────────────┤
│  17   │ &#39; &#39;  │ start          │ skip whitespace                 │                │
│  ...  │      │                │ (recovery complete!)            │                │
│       │      │                │ Continues normally:             │                │
│       │      │                │ var, x, =, 5, ;                 │                │
├──────────────────────────────────────────────────────────────────────────────────┤
│ Token Stream: [const] [s] [=] [.invalid] [var] [x] [=] [5] [;]                   │
│                                    │                                             │
│                                    └── Just the bad string, rest recovered       │
└──────────────────────────────────────────────────────────────────────────────────┘
</code></pre>
<h3 class="relative group">Example 3: Multiple Errors
    <div id="example-3-multiple-errors" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#example-3-multiple-errors" aria-label="Anchor">#</a>
    </span>
    
</h3>
<pre tabindex="0"><code>Input: &#34;const @# = `test`;&#34;

┌──────────────────────────────────────────────────────────────────────────────────┐
│                         MULTIPLE ERROR RECOVERY                                   │
├──────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│ Error 1: @# is invalid (@ not followed by identifier or &#34;)                      │
│ Error 2: ` is an illegal character                                              │
│                                                                                  │
│ Position:  const @# = `test`;                                                    │
│                   ^^   ^^^^^                                                     │
│                   │    │                                                         │
│                   │    └── Second invalid token                                  │
│                   └── First invalid token                                        │
│                                                                                  │
│ Token Stream:                                                                    │
│   [.keyword_const] [.invalid] [.equal] [.invalid] [.semicolon]                  │
│        &#34;const&#34;         &#34;@#&#34;      &#34;=&#34;     &#34;`test`&#34;      &#34;;&#34;                      │
│                                                                                  │
│ The tokenizer recovered TWICE and still got valid tokens in between!            │
│                                                                                  │
└──────────────────────────────────────────────────────────────────────────────────┘
</code></pre>
<h3 class="relative group">Example 4: Control Characters
    <div id="example-4-control-characters" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#example-4-control-characters" aria-label="Anchor">#</a>
    </span>
    
</h3>
<pre tabindex="0"><code>Input: &#34;const s = &#34;hel\x00lo&#34;;&#34;    (null byte embedded)

┌──────────────────────────────────────────────────────────────────────────────────┐
│ Index │ Char  │ State          │ Action                          │ Result        │
├──────────────────────────────────────────────────────────────────────────────────┤
│  10   │  &#39;&#34;&#39;  │ start          │ → string_literal                │               │
│  11   │  &#39;h&#39;  │ string_literal │ continue                        │               │
│  12   │  &#39;e&#39;  │ string_literal │ continue                        │               │
│  13   │  &#39;l&#39;  │ string_literal │ continue                        │               │
│  14   │ 0x00  │ string_literal │ NULL BYTE! Not at EOF!          │               │
│       │       │                │ → .invalid state                │               │
│  15   │  &#39;l&#39;  │ invalid        │ continue                        │               │
│  16   │  &#39;o&#39;  │ invalid        │ continue                        │               │
│  17   │  &#39;&#34;&#39;  │ invalid        │ continue (still invalid!)       │               │
│  18   │  &#39;;&#39;  │ invalid        │ continue                        │               │
│  19   │ EOF   │ invalid        │ At EOF, emit                    │ .invalid      │
├──────────────────────────────────────────────────────────────────────────────────┤
│ Note: Once in invalid state, even valid chars like &#34; don&#39;t escape it!           │
│       Only &#39;\n&#39; or EOF can end an invalid token.                                 │
└──────────────────────────────────────────────────────────────────────────────────┘
</code></pre>
<h3 class="relative group">Example 5: Invalid Tab in Comment
    <div id="example-5-invalid-tab-in-comment" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#example-5-invalid-tab-in-comment" aria-label="Anchor">#</a>
    </span>
    
</h3>
<pre tabindex="0"><code>Input: &#34;// comment\twith tab&#34;

┌──────────────────────────────────────────────────────────────────────────────────┐
│ Index │ Char  │ State         │ Action                          │ Result         │
├──────────────────────────────────────────────────────────────────────────────────┤
│   0   │  &#39;/&#39;  │ start         │ → slash                         │                │
│   1   │  &#39;/&#39;  │ slash         │ → line_comment_start            │                │
│   2   │  &#39; &#39;  │ line_comment  │ continue                        │                │
│  ...  │       │               │                                 │                │
│  10   │ &#39;\t&#39;  │ line_comment  │ TAB! Control char in comment    │                │
│       │       │               │ → .invalid state                │                │
│  ...  │       │               │ consume rest of line            │                │
│  19   │ EOF   │ invalid       │ emit                            │ .invalid       │
├──────────────────────────────────────────────────────────────────────────────────┤
│ Why tabs are invalid in comments:                                                │
│   - Ambiguous rendering (how many spaces is a tab?)                             │
│   - Zig spec requires unambiguous source representation                         │
│   - Use spaces instead, or zig fmt will fix it                                  │
└──────────────────────────────────────────────────────────────────────────────────┘
</code></pre>
<h3 class="relative group">Special Case: invalid_periodasterisks
    <div id="special-case-invalid_periodasterisks" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#special-case-invalid_periodasterisks" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>There&rsquo;s one special &ldquo;structured invalid&rdquo; token:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="c1">// This is specifically detected and given its own tag
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">.</span><span class="n">period_asterisk</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">buffer</span><span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">index</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#39;*&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">invalid_periodasterisks</span><span class="p">,</span><span class="w">  </span><span class="c1">// .**
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">period_asterisk</span><span class="p">,</span><span class="w">         </span><span class="c1">// .*
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">},</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Why? The sequence <code>.**</code> looks like it might be valid but isn&rsquo;t:</p>
<pre tabindex="0"><code>&#34;ptr&#34;.**    ← Looks like pointer dereference but extra *
             Results in .invalid_periodasterisks

This allows better error messages than generic .invalid
</code></pre>
<h3 class="relative group">Recovery Properties
    <div id="recovery-properties" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#recovery-properties" aria-label="Anchor">#</a>
    </span>
    
</h3>
<pre tabindex="0"><code>┌─────────────────────────────────────────────────────────────────────────────┐
│                    INVALID TOKEN GUARANTEES                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  1. BOUNDED SCOPE                                                            │
│     ─────────────                                                            │
│     Invalid tokens always end at:                                            │
│       • Newline (&#39;\n&#39;)                                                       │
│       • End of file (EOF)                                                    │
│                                                                              │
│     This means: errors on one line don&#39;t affect the next line               │
│                                                                              │
│  2. MONOTONIC PROGRESS                                                       │
│     ──────────────────                                                       │
│     self.index always increases                                              │
│     Tokenizer never gets stuck in infinite loop                             │
│                                                                              │
│  3. NO CASCADING                                                             │
│     ─────────────                                                            │
│     After emitting .invalid, returns to .start state                        │
│     Ready to tokenize next valid content                                    │
│                                                                              │
│  4. POSITION PRESERVATION                                                    │
│     ─────────────────────                                                    │
│     Invalid token has loc.start and loc.end                                 │
│     Error reporter can show exactly what was invalid                        │
│                                                                              │
│  5. TESTABLE                                                                 │
│     ────────                                                                 │
│     Token stream always valid (may contain .invalid tokens)                 │
│     Parser can handle .invalid gracefully                                   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
</code></pre>
<h3 class="relative group">How the Parser Handles Invalid Tokens
    <div id="how-the-parser-handles-invalid-tokens" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#how-the-parser-handles-invalid-tokens" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>When the parser encounters <code>.invalid</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="c1">// In parser (simplified)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fn</span><span class="w"> </span><span class="nf">parseExpression</span><span class="p">()</span><span class="w"> </span><span class="n">Error</span><span class="o">!*</span><span class="n">Node</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tokenizer</span><span class="p">.</span><span class="nf">next</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">token</span><span class="p">.</span><span class="n">tag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="n">invalid</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Report error with source location
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="n">errors</span><span class="p">.</span><span class="nf">add</span><span class="p">(.{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">invalid_token</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="n">loc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">token</span><span class="p">.</span><span class="n">loc</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// Skip and try to continue
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">error</span><span class="p">.</span><span class="n">InvalidToken</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ... normal cases
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>This allows the compiler to:</p>
<ol>
<li>Report the error with precise location</li>
<li>Continue parsing to find more errors</li>
<li>Give the user multiple error messages in one compile</li>
</ol>

<h3 class="relative group">Test Cases from the Tokenizer
    <div id="test-cases-from-the-tokenizer" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#test-cases-from-the-tokenizer" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>The tokenizer has extensive tests for invalid scenarios:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="k">test</span><span class="w"> </span><span class="s">&#34;invalid token characters&#34;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="nf">testTokenize</span><span class="p">(</span><span class="s">&#34;#&#34;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">.{.</span><span class="n">invalid</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="nf">testTokenize</span><span class="p">(</span><span class="s">&#34;`&#34;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">.{.</span><span class="n">invalid</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="nf">testTokenize</span><span class="p">(</span><span class="s">&#34;&#39;c&#34;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">.{.</span><span class="n">invalid</span><span class="p">});</span><span class="w">      </span><span class="c1">// Unterminated char
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="nf">testTokenize</span><span class="p">(</span><span class="s">&#34;&#39;&#34;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">.{.</span><span class="n">invalid</span><span class="p">});</span><span class="w">       </span><span class="c1">// Empty char start
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="nf">testTokenize</span><span class="p">(</span><span class="s">&#34;&#39;&#39;&#34;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">.{.</span><span class="n">char_literal</span><span class="p">});</span><span class="w"> </span><span class="c1">// Empty char is valid!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="nf">testTokenize</span><span class="p">(</span><span class="s">&#34;&#39;</span><span class="se">\n</span><span class="s">&#39;&#34;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">.{</span><span class="w"> </span><span class="p">.</span><span class="n">invalid</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">invalid</span><span class="w"> </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">test</span><span class="w"> </span><span class="s">&#34;invalid literal/comment characters&#34;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="nf">testTokenize</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\&#34;\x00\&#34;</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">.{.</span><span class="n">invalid</span><span class="p">});</span><span class="w">  </span><span class="c1">// Null in string
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="nf">testTokenize</span><span class="p">(</span><span class="s">&#34;//</span><span class="se">\x00</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">.{.</span><span class="n">invalid</span><span class="p">});</span><span class="w">    </span><span class="c1">// Null in comment
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="nf">testTokenize</span><span class="p">(</span><span class="s">&#34;//</span><span class="se">\x1f</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">.{.</span><span class="n">invalid</span><span class="p">});</span><span class="w">    </span><span class="c1">// Control char
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="nf">testTokenize</span><span class="p">(</span><span class="s">&#34;//</span><span class="se">\x7f</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">.{.</span><span class="n">invalid</span><span class="p">});</span><span class="w">    </span><span class="c1">// DEL char
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">test</span><span class="w"> </span><span class="s">&#34;invalid tabs and carriage returns&#34;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="nf">testTokenize</span><span class="p">(</span><span class="s">&#34;//</span><span class="se">\t</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">.{.</span><span class="n">invalid</span><span class="p">});</span><span class="w">      </span><span class="c1">// Tab in comment
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="nf">testTokenize</span><span class="p">(</span><span class="s">&#34;//</span><span class="se">\r</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">.{.</span><span class="n">invalid</span><span class="p">});</span><span class="w">      </span><span class="c1">// Bare CR
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="nf">testTokenize</span><span class="p">(</span><span class="s">&#34;//</span><span class="se">\r\n</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">.{});</span><span class="w">            </span><span class="c1">// CR+LF is valid
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">test</span><span class="w"> </span><span class="s">&#34;null byte before eof&#34;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="nf">testTokenize</span><span class="p">(</span><span class="s">&#34;123 </span><span class="se">\x00</span><span class="s"> 456&#34;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">.{</span><span class="w"> </span><span class="p">.</span><span class="n">number_literal</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">invalid</span><span class="w"> </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="nf">testTokenize</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\x00</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">.{.</span><span class="n">invalid</span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">test</span><span class="w"> </span><span class="s">&#34;invalid builtin identifiers&#34;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="nf">testTokenize</span><span class="p">(</span><span class="s">&#34;@()&#34;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">.{.</span><span class="n">invalid</span><span class="p">});</span><span class="w">      </span><span class="c1">// @ then (
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="nf">testTokenize</span><span class="p">(</span><span class="s">&#34;@0()&#34;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">.{.</span><span class="n">invalid</span><span class="p">});</span><span class="w">     </span><span class="c1">// @ then digit
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">test</span><span class="w"> </span><span class="s">&#34;invalid token with unfinished escape&#34;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="nf">testTokenize</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\&#34;\\</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">.{.</span><span class="n">invalid</span><span class="p">});</span><span class="w">     </span><span class="c1">// String with \ at EOF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="nf">testTokenize</span><span class="p">(</span><span class="s">&#34;&#39;</span><span class="se">\\</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">.{.</span><span class="n">invalid</span><span class="p">});</span><span class="w">      </span><span class="c1">// Char with \ at EOF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div>
<h2 class="relative group">Performance Considerations
    <div id="performance-considerations" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#performance-considerations" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>The tokenizer is designed for speed:</p>
<pre tabindex="0"><code>┌─────────────────────────────────────────────────────────────────┐
│                    PERFORMANCE FEATURES                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  1. SINGLE-PASS                                                  │
│     ┌─▶ Each character examined exactly once                     │
│     │   No backtracking                                          │
│     │                                                            │
│  2. NO ALLOCATIONS                                               │
│     │   Tokens are just (start, end) pairs                       │
│     │   Reference original source buffer                         │
│     │                                                            │
│  3. BRANCH PREDICTION                                            │
│     │   Common cases (whitespace, identifiers) first             │
│     │   Hot paths optimized                                      │
│     │                                                            │
│  4. NULL-TERMINATED SOURCE                                       │
│     │   No bounds checking on every character                    │
│     │   EOF detection is free                                    │
│     │                                                            │
│  5. LABELED SWITCH CONTINUE                                      │
│     └── State transitions without function call overhead         │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
</code></pre>
<h2 class="relative group">Try It Yourself
    <div id="try-it-yourself" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#try-it-yourself" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>You can explore how the tokenizer works by dumping the tokens for any Zig file:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># See all tokens for a file</span>
</span></span><span class="line"><span class="cl">zig ast-check --dump-tokens your_file.zig
</span></span></code></pre></td></tr></table>
</div>
</div><p>This is a great way to understand how Zig breaks down your code into its fundamental pieces.</p>
<hr>

<h2 class="relative group">Further Reading
    <div id="further-reading" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#further-reading" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>For deeper exploration of Zig&rsquo;s tokenizer:</p>
<ul>
<li>
<p><strong><a
  href="https://mitchellh.com/zig/tokenizer"
    target="_blank"
  >Zig Tokenizer</a></strong> by Mitchell Hashimoto - An excellent deep dive into the tokenizer implementation, state machine design, and performance optimizations.</p>
</li>
<li>
<p><strong><a
  href="https://github.com/ziglang/zig/wiki/Glossary"
    target="_blank"
  >Zig GitHub Wiki Glossary</a></strong> - Official terminology for compiler internals.</p>
</li>
<li>
<p><strong>Source Code</strong>: <a
  href="https://github.com/ziglang/zig/blob/master/lib/std/zig/Tokenizer.zig"
    target="_blank"
  ><code>lib/std/zig/Tokenizer.zig</code></a> - The actual implementation (1,769 lines of elegant Zig).</p>
</li>
</ul>
<hr>

<h2 class="relative group">Conclusion
    <div id="conclusion" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#conclusion" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>Zig&rsquo;s tokenizer is a masterclass in hand-crafted compiler engineering. By using a state machine with labeled switch continues, it achieves excellent performance while remaining readable and maintainable.</p>
<p>Key takeaways:</p>
<ul>
<li><strong>41 states</strong> handle all of Zig&rsquo;s lexical complexity</li>
<li><strong>185 token types</strong> from keywords to complex operators</li>
<li><strong>Zero allocations</strong> - tokens reference the original source</li>
<li><strong>Single pass</strong> - each character examined once</li>
<li><strong>Error recovery</strong> - continues parsing after invalid input</li>
</ul>
<p>The tokenizer&rsquo;s job is to produce a flat stream of tokens. In the next article, we&rsquo;ll see how the <strong>Parser</strong> transforms this stream into a tree structure: the <strong>Abstract Syntax Tree (AST)</strong>.</p>
<hr>
<p><strong>Previous</strong>: <a
  href="./01-bootstrap-process.md">Part 1: Bootstrap Process</a>
<strong>Next</strong>: <a
  href="./03-parser-ast.md">Part 3: Parser and AST</a></p>
<p><strong>Series Index</strong>:</p>
<ol>
<li><a
  href="./01-bootstrap-process.md">Bootstrap Process</a></li>
<li><strong>Tokenizer</strong> (this article)</li>
<li><a
  href="./03-parser-ast.md">Parser and AST</a></li>
<li><a
  href="./04-zir-generation.md">ZIR Generation</a></li>
<li><a
  href="./05-sema.md">Semantic Analysis</a></li>
<li><a
  href="./06-air-codegen.md">AIR and Code Generation</a></li>
<li><a
  href="./07-linking.md">Linking</a></li>
</ol>

          
          
          
        </div>
        
        

        

        

      </div>

      
      
        
        
          
          
        
        
        
        <script
          type="text/javascript"
          src="/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js"
          integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA=="
          data-oid="views_drafts/02-tokenizer.md"
          data-oid-likes="likes_drafts/02-tokenizer.md"></script>
      
    </section>

    
    <footer class="pt-8 max-w-prose print:hidden">
      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600">
      <div class="flex justify-between pt-3">
        <span class="flex flex-col">
          
            <a
              class="flex text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
              href="/drafts/03-parser-ast/">
              <span class="leading-6">
                <span class="inline-block rtl:rotate-180">&larr;</span>&ensp;Zig Compiler Internals Part 3: Parser and AST
              </span>
            </a>
            
              <span class="ms-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400">
                <time datetime="2025-12-17T00:00:00&#43;00:00">December 17, 2025</time>
              </span>
            
          
        </span>
        <span class="flex flex-col items-end">
          
            <a
              class="flex text-right text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
              href="/drafts/01-bootstrap-process/">
              <span class="leading-6">
                Zig Compiler Internals Part 1: The Bootstrap Process&ensp;<span class="inline-block rtl:rotate-180">&rarr;</span>
              </span>
            </a>
            
              <span class="me-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400">
                <time datetime="2025-12-17T00:00:00&#43;00:00">December 17, 2025</time>
              </span>
            
          
        </span>
      </div>
    </div>
  


      
    </footer>
  </article>

        


  






<div
  id="scroll-to-top"
  class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200">
  <a
    href="#the-top"
    class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top"
    title="Scroll to top">
    &uarr;
  </a>
</div>

      </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
  
  <div class="flex items-center justify-between">
    
    
      <p class="text-sm text-neutral-500 dark:text-neutral-400">
          &copy;
          2025
          Yohai
      </p>
    

    
    
      <p class="text-xs text-neutral-500 dark:text-neutral-400">
        
        
        Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
          href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
          href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a>
      </p>
    
  </div>
  
    <script>
      mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
        margin: 24,
        background: "rgba(0,0,0,0.5)",
        scrollOffset: 0,
      });
    </script>
  
  
  
  <script
    type="text/javascript"
    src="/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js"
    integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500"
  data-url="http://localhost:1313/">
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800">
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0">
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)">
        <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
  
</html>
