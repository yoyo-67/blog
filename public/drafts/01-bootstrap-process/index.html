<!doctype html>
<html
  lang="en-us"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="dark"
  data-auto-appearance="true"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
  
    <meta http-equiv="content-language" content="en-us">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color">

  
  
    <title>Zig Compiler Internals Part 1: The Bootstrap Process &middot; Yohai&#39;s Blog</title>
    <meta name="title" content="Zig Compiler Internals Part 1: The Bootstrap Process &middot; Yohai&#39;s Blog">
  

  
  
  
  
  
  <link rel="canonical" href="http://localhost:1313/drafts/01-bootstrap-process/">
  

  
  
    <meta name="author" content="Yohai">
  
  

  
  <meta property="og:url" content="http://localhost:1313/drafts/01-bootstrap-process/">
  <meta property="og:site_name" content="Yohai&#39;s Blog">
  <meta property="og:title" content="Zig Compiler Internals Part 1: The Bootstrap Process">
  <meta property="og:description" content="Zig Compiler Internals Part 1: The Bootstrap Process # How Zig builds itself from nothing but a C compiler
Introduction # One of the most fascinating aspects of the Zig programming language is how it compiles itself. Zig is a self-hosted compiler, meaning the Zig compiler is written in Zig. But this creates a chicken-and-egg problem: how do you compile the Zig compiler if you donâ€™t have a Zig compiler yet?">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="drafts">
    <meta property="article:published_time" content="2025-12-17T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-12-17T00:00:00+00:00">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Zig Compiler Internals Part 1: The Bootstrap Process">
  <meta name="twitter:description" content="Zig Compiler Internals Part 1: The Bootstrap Process # How Zig builds itself from nothing but a C compiler
Introduction # One of the most fascinating aspects of the Zig programming language is how it compiles itself. Zig is a self-hosted compiler, meaning the Zig compiler is written in Zig. But this creates a chicken-and-egg problem: how do you compile the Zig compiler if you donâ€™t have a Zig compiler yet?">

  
  
  
  
    
      
    
  
    
      
    
  
    
      
    
  
  
    
  

  
  
  
  
  
  

  

  
  
  
  
  
  
  
  
    
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.0975a8c7c266a0697f94839b45e1574c449de253527d44ed516d5c5c3c820c9389d7d86576faae12267b129f8749ecbf7581cddb636aba7690aa633b95aaa87d.css"
    integrity="sha512-CXWox8JmoGl/lIObReFXTESd4lNSfUTtUW1cXDyCDJOJ19hldvquEiZ7Ep&#43;HSey/dYHN22NqunaQqmM7laqofQ==">

  
  
  <script
    type="text/javascript"
    src="/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js"
    integrity="sha512-b0EXSzoFtoCCD&#43;CMrb&#43;l&#43;3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script>
  
  
  
  
  
  
    
    <script src="/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js" integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7&#43;kfJ6kKCJxQGC&#43;8wm&#43;Bz9JucDjDTGNew=="></script>
  

  
  
  
    
  
  
    
  
  
    
  
  
  
  
  
  
    
    <script
      defer
      type="text/javascript"
      id="script-bundle"
      src="/js/main.bundle.min.9cc802d09f28c6af56ceee7bc6e320a39251fdae98243f2a9942f221ac57a9f49c51609699a91794a7b2580ee1deaa8e4d794a68ffa94aa317c66e893ce51e02.js"
      integrity="sha512-nMgC0J8oxq9Wzu57xuMgo5JR/a6YJD8qmULyIaxXqfScUWCWmakXlKeyWA7h3qqOTXlKaP&#43;pSqMXxm6JPOUeAg=="
      data-copy="Copy"
      data-copied="Copied"></script>
  

  
  

<script src="/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js" integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj&#43;KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script>


























  

  

  

  

  





  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
  

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Drafts",
    "name": "Zig Compiler Internals Part 1: The Bootstrap Process",
    "headline": "Zig Compiler Internals Part 1: The Bootstrap Process",
    
    "abstract": "\u003ch1 class=\u0022relative group\u0022\u003eZig Compiler Internals Part 1: The Bootstrap Process\n    \u003cdiv id=\u0022zig-compiler-internals-part-1-the-bootstrap-process\u0022 class=\u0022anchor\u0022\u003e\u003c\/div\u003e\n    \n    \u003cspan\n        class=\u0022absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none\u0022\u003e\n        \u003ca class=\u0022text-primary-300 dark:text-neutral-700 !no-underline\u0022 href=\u0022#zig-compiler-internals-part-1-the-bootstrap-process\u0022 aria-label=\u0022Anchor\u0022\u003e#\u003c\/a\u003e\n    \u003c\/span\u003e\n    \n\u003c\/h1\u003e\n\u003cp\u003e\u003cem\u003eHow Zig builds itself from nothing but a C compiler\u003c\/em\u003e\u003c\/p\u003e\n\u003chr\u003e\n\n\u003ch2 class=\u0022relative group\u0022\u003eIntroduction\n    \u003cdiv id=\u0022introduction\u0022 class=\u0022anchor\u0022\u003e\u003c\/div\u003e\n    \n    \u003cspan\n        class=\u0022absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none\u0022\u003e\n        \u003ca class=\u0022text-primary-300 dark:text-neutral-700 !no-underline\u0022 href=\u0022#introduction\u0022 aria-label=\u0022Anchor\u0022\u003e#\u003c\/a\u003e\n    \u003c\/span\u003e\n    \n\u003c\/h2\u003e\n\u003cp\u003eOne of the most fascinating aspects of the Zig programming language is how it compiles itself. Zig is a \u003cstrong\u003eself-hosted\u003c\/strong\u003e compiler, meaning the Zig compiler is written in Zig. But this creates a chicken-and-egg problem: how do you compile the Zig compiler if you don\u0026rsquo;t have a Zig compiler yet?\u003c\/p\u003e",
    "inLanguage": "en-us",
    "url" : "http://localhost:1313/drafts/01-bootstrap-process/",
    "author" : {
      "@type": "Person",
      "name": "Yohai"
    },
    "copyrightYear": "2025",
    "dateCreated": "2025-12-17T00:00:00\u002b00:00",
    "datePublished": "2025-12-17T00:00:00\u002b00:00",
    
    "dateModified": "2025-12-17T00:00:00\u002b00:00",
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "5567"
  }]
  </script>



  
  

  
  

  
  

  
  

  
  
</head>


















  
  
  <body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
    <div id="the-top" class="absolute flex self-center">
      <a
        class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content">
        <span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
        Skip to main content
      </a>
    </div>
    
    
      













<div
  class="main-menu flex items-center justify-between py-6 md:justify-start gap-x-3 pt-[2px] pr-2 md:pr-4 pb-[3px] pl-0">
  
  

  <div class="flex flex-1 items-center justify-between">
    <nav class="flex space-x-3">
      
        <a href="/" class="text-base font-medium">
          Yohai&rsquo;s Blog
        </a>
      
    </nav>
    
  <nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12">
    
      
        
  <a
  href="/posts/"
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  aria-label="Posts"
  title="Posts">
  
  
    <p class="text-base font-medium">
      Posts
    </p>
  
</a>



      
        
  <a
  href="/drafts/"
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  aria-label="Drafts"
  title="Drafts">
  
  
    <p class="text-base font-medium">
      Drafts
    </p>
  
</a>



      
        
  <a
  href="/tags/"
  
  class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
  aria-label="Tags"
  title="Tags">
  
  
    <p class="text-base font-medium">
      Tags
    </p>
  
</a>



      
    

    

    

    
      <button
        id="search-button"
        aria-label="Search"
        class="text-base hover:text-primary-600 dark:hover:text-primary-400"
        title="Search (/)">
        <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
      </button>
    

    
      <div class=" flex items-center">
        <button
          id="appearance-switcher"
          aria-label="Dark mode switcher"
          type="button"
          class="text-base hover:text-primary-600 dark:hover:text-primary-400">
          <div class="flex items-center justify-center dark:hidden">
            <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span>
          </div>
          <div class="items-center justify-center hidden dark:flex">
            <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span>
          </div>
        </button>
      </div>
    
  </nav>

    
  <div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12">
    <span></span>

    

    

    
      <button
        id="search-button-mobile"
        aria-label="Search"
        class="text-base hover:text-primary-600 dark:hover:text-primary-400"
        title="Search (/)">
        <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
      </button>
    

    
      <button
        id="appearance-switcher-mobile"
        aria-label="Dark mode switcher"
        type="button"
        class="text-base hover:text-primary-600 dark:hover:text-primary-400 me-1">
        <div class="flex items-center justify-center dark:hidden">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span>
        </div>
        <div class="items-center justify-center hidden dark:flex">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span>
        </div>
      </button>
    
  </div>

  </div>
  
  <div class="-my-2 md:hidden">
    <div id="menu-button" class="block">
      
        <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
          <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>
</span>
        </div>
        <div
          id="menu-wrapper"
          class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50 pt-[5px]">
          <ul
            class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none text-end max-w-7xl">
            <li id="menu-close-button">
              <span
                class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">
                <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
              </span>
            </li>

            
              
  <li class="mt-1">
  <a
    href="/posts/"
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    aria-label="Posts"
    title="Posts">
    
    
      <p class="text-bg font-bg">
        Posts
      </p>
    
  </a>
</li>



            
              
  <li class="mt-1">
  <a
    href="/drafts/"
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    aria-label="Drafts"
    title="Drafts">
    
    
      <p class="text-bg font-bg">
        Drafts
      </p>
    
  </a>
</li>



            
              
  <li class="mt-1">
  <a
    href="/tags/"
    
    class="flex items-center hover:text-primary-600 dark:hover:text-primary-400"
    aria-label="Tags"
    title="Tags">
    
    
      <p class="text-bg font-bg">
        Tags
      </p>
    
  </a>
</li>



            

          </ul>
          
        </div>
      
    </div>
  </div>

</div>





    
    <div class="relative flex flex-col grow">
      <main id="main-content" class="grow">
        
  
  <article>
    
    

    
    <header id="single_header" class="mt-5 max-w-prose">
      
        <ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
  
  
    
  
    
  
  <li class="hidden">
    <a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href="/"
      >Yohai&#39;s Blog</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline">
    <a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href="/drafts/"
      >Drafts</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="hidden">
    <a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href="/drafts/01-bootstrap-process/"
      >Zig Compiler Internals Part 1: The Bootstrap Process</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        Zig Compiler Internals Part 1: The Bootstrap Process
      </h1>
      <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        





  
  



  

  
  
  
    
  

  

  
    
  

  

  
    
  

  
    
  

  

  

  

  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2025-12-17T00:00:00&#43;00:00">December 17, 2025</time><span class="px-2 text-primary-500">&middot;</span><span>5567 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">27 mins</span>
    

    
    
  </div>

  

  
  

  
  



      </div>
      
        
  
  
  
  
  
  

  

  
    
    
<div class="flex author">
  
  <div class="place-self-center">
    
      <div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">
        Author
      </div>
      <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
        Yohai
      </div>
    
    
    <div class="text-2xl sm:text-lg">
</div>
  </div>
</div>

  

  

  
    <div class="mb-5"></div>
  

      
    </header>

    
    <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
      
      
      
      
      
        <div class="order-first lg:ml-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs">
          <div class="toc ps-5 print:hidden lg:sticky lg:top-10">
            
              <details
  open
  id="TOCView"
  class="toc-right mt-0 overflow-y-auto overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg -ms-5 ps-5 pe-2 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#the-chicken-and-egg-problem">The Chicken-and-Egg Problem</a></li>
    <li><a href="#the-bootstrap-stages---big-picture">The Bootstrap Stages - Big Picture</a></li>
    <li><a href="#the-key-insight-webassembly-as-a-universal-binary">The Key Insight: WebAssembly as a Universal Binary</a></li>
    <li><a href="#stage-0-the-c-bootstrap-bootstrapc">Stage 0: The C Bootstrap (<code>bootstrap.c</code>)</a>
      <ul>
        <li><a href="#the-entry-point">The Entry Point</a></li>
        <li><a href="#host-detection-actual-source-code">Host Detection (Actual Source Code)</a></li>
        <li><a href="#process-execution-helper">Process Execution Helper</a></li>
        <li><a href="#step-1-build-the-webassembly-to-c-transpiler">Step 1: Build the WebAssembly-to-C Transpiler</a></li>
        <li><a href="#step-2-convert-zig1wasm-to-c">Step 2: Convert zig1.wasm to C</a></li>
        <li><a href="#step-3-compile-zig1">Step 3: Compile zig1</a></li>
        <li><a href="#step-4-generate-build-configuration">Step 4: Generate Build Configuration</a></li>
        <li><a href="#step-5-build-zig2-using-zig1">Step 5: Build zig2 Using zig1</a></li>
        <li><a href="#step-6-build-compiler_rt">Step 6: Build compiler_rt</a></li>
        <li><a href="#step-7-compile-zig2-to-native-code">Step 7: Compile zig2 to Native Code</a></li>
      </ul>
    </li>
    <li><a href="#the-webassembly-to-c-transpiler-wasm2cc">The WebAssembly-to-C Transpiler (<code>wasm2c.c</code>)</a>
      <ul>
        <li><a href="#understanding-webassembly-binary-format">Understanding WebAssembly Binary Format</a></li>
        <li><a href="#webassembly-section-ids-from-wasmh">WebAssembly Section IDs (from <code>wasm.h</code>)</a></li>
        <li><a href="#webassembly-value-types">WebAssembly Value Types</a></li>
        <li><a href="#webassembly-opcodes">WebAssembly Opcodes</a></li>
        <li><a href="#how-wasm2c-generates-c-code">How wasm2c Generates C Code</a></li>
        <li><a href="#generated-helper-functions">Generated Helper Functions</a></li>
        <li><a href="#function-generation">Function Generation</a></li>
      </ul>
    </li>
    <li><a href="#wasi-the-system-interface-wasic">WASI: The System Interface (<code>wasi.c</code>)</a>
      <ul>
        <li><a href="#wasi-architecture">WASI Architecture</a></li>
        <li><a href="#wasi-error-codes">WASI Error Codes</a></li>
        <li><a href="#file-descriptor-management">File Descriptor Management</a></li>
        <li><a href="#key-wasi-functions">Key WASI Functions</a></li>
      </ul>
    </li>
    <li><a href="#the-c-backend-how-zig-outputs-c">The C Backend: How Zig Outputs C</a>
      <ul>
        <li><a href="#example-transformation">Example Transformation</a></li>
        <li><a href="#why-c-output">Why C Output?</a></li>
      </ul>
    </li>
    <li><a href="#complete-bootstrap-timeline">Complete Bootstrap Timeline</a></li>
    <li><a href="#key-design-decisions">Key Design Decisions</a>
      <ul>
        <li><a href="#1-minimal-dependencies">1. Minimal Dependencies</a></li>
        <li><a href="#2-deterministic-builds">2. Deterministic Builds</a></li>
        <li><a href="#3-self-improving-compilation">3. Self-Improving Compilation</a></li>
      </ul>
    </li>
    <li><a href="#updating-the-bootstrap">Updating the Bootstrap</a></li>
    <li><a href="#historical-context">Historical Context</a></li>
    <li><a href="#summary-the-complete-picture">Summary: The Complete Picture</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#further-reading">Further Reading</a></li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#the-chicken-and-egg-problem">The Chicken-and-Egg Problem</a></li>
    <li><a href="#the-bootstrap-stages---big-picture">The Bootstrap Stages - Big Picture</a></li>
    <li><a href="#the-key-insight-webassembly-as-a-universal-binary">The Key Insight: WebAssembly as a Universal Binary</a></li>
    <li><a href="#stage-0-the-c-bootstrap-bootstrapc">Stage 0: The C Bootstrap (<code>bootstrap.c</code>)</a>
      <ul>
        <li><a href="#the-entry-point">The Entry Point</a></li>
        <li><a href="#host-detection-actual-source-code">Host Detection (Actual Source Code)</a></li>
        <li><a href="#process-execution-helper">Process Execution Helper</a></li>
        <li><a href="#step-1-build-the-webassembly-to-c-transpiler">Step 1: Build the WebAssembly-to-C Transpiler</a></li>
        <li><a href="#step-2-convert-zig1wasm-to-c">Step 2: Convert zig1.wasm to C</a></li>
        <li><a href="#step-3-compile-zig1">Step 3: Compile zig1</a></li>
        <li><a href="#step-4-generate-build-configuration">Step 4: Generate Build Configuration</a></li>
        <li><a href="#step-5-build-zig2-using-zig1">Step 5: Build zig2 Using zig1</a></li>
        <li><a href="#step-6-build-compiler_rt">Step 6: Build compiler_rt</a></li>
        <li><a href="#step-7-compile-zig2-to-native-code">Step 7: Compile zig2 to Native Code</a></li>
      </ul>
    </li>
    <li><a href="#the-webassembly-to-c-transpiler-wasm2cc">The WebAssembly-to-C Transpiler (<code>wasm2c.c</code>)</a>
      <ul>
        <li><a href="#understanding-webassembly-binary-format">Understanding WebAssembly Binary Format</a></li>
        <li><a href="#webassembly-section-ids-from-wasmh">WebAssembly Section IDs (from <code>wasm.h</code>)</a></li>
        <li><a href="#webassembly-value-types">WebAssembly Value Types</a></li>
        <li><a href="#webassembly-opcodes">WebAssembly Opcodes</a></li>
        <li><a href="#how-wasm2c-generates-c-code">How wasm2c Generates C Code</a></li>
        <li><a href="#generated-helper-functions">Generated Helper Functions</a></li>
        <li><a href="#function-generation">Function Generation</a></li>
      </ul>
    </li>
    <li><a href="#wasi-the-system-interface-wasic">WASI: The System Interface (<code>wasi.c</code>)</a>
      <ul>
        <li><a href="#wasi-architecture">WASI Architecture</a></li>
        <li><a href="#wasi-error-codes">WASI Error Codes</a></li>
        <li><a href="#file-descriptor-management">File Descriptor Management</a></li>
        <li><a href="#key-wasi-functions">Key WASI Functions</a></li>
      </ul>
    </li>
    <li><a href="#the-c-backend-how-zig-outputs-c">The C Backend: How Zig Outputs C</a>
      <ul>
        <li><a href="#example-transformation">Example Transformation</a></li>
        <li><a href="#why-c-output">Why C Output?</a></li>
      </ul>
    </li>
    <li><a href="#complete-bootstrap-timeline">Complete Bootstrap Timeline</a></li>
    <li><a href="#key-design-decisions">Key Design Decisions</a>
      <ul>
        <li><a href="#1-minimal-dependencies">1. Minimal Dependencies</a></li>
        <li><a href="#2-deterministic-builds">2. Deterministic Builds</a></li>
        <li><a href="#3-self-improving-compilation">3. Self-Improving Compilation</a></li>
      </ul>
    </li>
    <li><a href="#updating-the-bootstrap">Updating the Bootstrap</a></li>
    <li><a href="#historical-context">Historical Context</a></li>
    <li><a href="#summary-the-complete-picture">Summary: The Complete Picture</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#further-reading">Further Reading</a></li>
  </ul>
</nav>
  </div>
</details>



            
          </div>
        </div>
      


      <div class="min-w-0 min-h-0 max-w-fit">
        

        <div class="article-content max-w-prose mb-20">
          
<h1 class="relative group">Zig Compiler Internals Part 1: The Bootstrap Process
    <div id="zig-compiler-internals-part-1-the-bootstrap-process" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#zig-compiler-internals-part-1-the-bootstrap-process" aria-label="Anchor">#</a>
    </span>
    
</h1>
<p><em>How Zig builds itself from nothing but a C compiler</em></p>
<hr>

<h2 class="relative group">Introduction
    <div id="introduction" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#introduction" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>One of the most fascinating aspects of the Zig programming language is how it compiles itself. Zig is a <strong>self-hosted</strong> compiler, meaning the Zig compiler is written in Zig. But this creates a chicken-and-egg problem: how do you compile the Zig compiler if you don&rsquo;t have a Zig compiler yet?</p>
<p>The answer is Zig&rsquo;s elegant <strong>multi-stage bootstrap process</strong>. In this article, we&rsquo;ll dive deep into how Zig solves this problem using only a C99 compiler as the starting point.</p>

<h2 class="relative group">The Chicken-and-Egg Problem
    <div id="the-chicken-and-egg-problem" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#the-chicken-and-egg-problem" aria-label="Anchor">#</a>
    </span>
    
</h2>
<pre tabindex="0"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    THE SELF-HOSTING PARADOX                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚    Zig Compiler                              Zig Compiler                    â”‚
â”‚    (written in Zig)  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  (executable)                   â”‚
â”‚          â”‚                                         â–²                         â”‚
â”‚          â”‚                                         â”‚                         â”‚
â”‚          â”‚              NEEDS                      â”‚                         â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                                              â”‚
â”‚    ğŸ” To compile Zig code, you need a Zig compiler                          â”‚
â”‚    ğŸ¥š To get a Zig compiler, you need to compile Zig code                   â”‚
â”‚                                                                              â”‚
â”‚    HOW DO YOU START?                                                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><p>The solution: use a <strong>different language</strong> to break the cycle. Zig uses C as the escape hatch.</p>

<h2 class="relative group">The Bootstrap Stages - Big Picture
    <div id="the-bootstrap-stages---big-picture" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#the-bootstrap-stages---big-picture" aria-label="Anchor">#</a>
    </span>
    
</h2>
<pre tabindex="0"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ZIG BOOTSTRAP OVERVIEW                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  STAGE 0: Pure C (uses system C compiler)                                   â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                   â”‚
â”‚                                                                              â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚    â”‚ bootstrap.c  â”‚   cc    â”‚  zig-wasm2c  â”‚  wasm2c â”‚   zig1.c     â”‚       â”‚
â”‚    â”‚ wasm2c.c     â”‚ â”€â”€â”€â”€â”€â”€â–¶ â”‚  executable  â”‚ â”€â”€â”€â”€â”€â”€â–¶ â”‚ (huge file)  â”‚       â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                    â”‚                        â”‚                â”‚
â”‚                                    â–¼                        â”‚                â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚                â”‚
â”‚    â”‚ zig1.wasm    â”‚ â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   convert    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚    â”‚ (3MB binary) â”‚         â”‚   wasmâ†’C     â”‚                                â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                    â”‚                                         â”‚
â”‚                                    â–¼                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   cc    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚    â”‚ zig1.c       â”‚ â”€â”€â”€â”€â”€â”€â–¶ â”‚    zig1      â”‚  â—€â”€â”€ First Zig compiler!       â”‚
â”‚    â”‚ wasi.c       â”‚         â”‚  executable  â”‚                                â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                    â”‚                                         â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                    â”‚                                         â”‚
â”‚  STAGE 1: Use zig1 to compile Zig to C                                      â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                      â”‚
â”‚                                    â”‚                                         â”‚
â”‚                                    â–¼                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  zig1   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚    â”‚ src/main.zig â”‚ â”€â”€â”€â”€â”€â”€â–¶ â”‚   zig2.c     â”‚  Zig compiler as C code        â”‚
â”‚    â”‚ (Zig source) â”‚-ofmt=c  â”‚              â”‚                                â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                    â”‚                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  zig1   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚    â”‚compiler_rt   â”‚ â”€â”€â”€â”€â”€â”€â–¶ â”‚compiler_rt.c â”‚                                â”‚
â”‚    â”‚    .zig      â”‚-ofmt=c  â”‚              â”‚                                â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                    â”‚                                         â”‚
â”‚                                    â–¼                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   cc    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚    â”‚ zig2.c       â”‚ â”€â”€â”€â”€â”€â”€â–¶ â”‚    zig2      â”‚  â—€â”€â”€ Full Zig compiler!        â”‚
â”‚    â”‚compiler_rt.c â”‚         â”‚  executable  â”‚                                â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                    â”‚                                         â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                    â”‚                                         â”‚
â”‚  STAGE 2+: Self-hosted compilation                                          â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                          â”‚
â”‚                                    â”‚                                         â”‚
â”‚                                    â–¼                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  zig2   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚    â”‚ src/main.zig â”‚ â”€â”€â”€â”€â”€â”€â–¶ â”‚    zig3      â”‚  â—€â”€â”€ Production compiler       â”‚
â”‚    â”‚ (Zig source) â”‚  build  â”‚  (stage 3)   â”‚      (with LLVM, optimized)    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h2 class="relative group">The Key Insight: WebAssembly as a Universal Binary
    <div id="the-key-insight-webassembly-as-a-universal-binary" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#the-key-insight-webassembly-as-a-universal-binary" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>Why WebAssembly? Here&rsquo;s the genius:</p>
<pre tabindex="0"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WHY WEBASSEMBLY FOR BOOTSTRAP?                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Traditional Bootstrap Problem:                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚                                                                              â”‚
â”‚    Linux x86_64 â”€â”€â–¶ Needs x86_64 bootstrap binary                           â”‚
â”‚    Linux ARM64  â”€â”€â–¶ Needs ARM64 bootstrap binary                            â”‚
â”‚    macOS x86_64 â”€â”€â–¶ Needs macOS x86_64 bootstrap binary                     â”‚
â”‚    macOS ARM64  â”€â”€â–¶ Needs macOS ARM64 bootstrap binary                      â”‚
â”‚    Windows      â”€â”€â–¶ Needs Windows bootstrap binary                          â”‚
â”‚    FreeBSD      â”€â”€â–¶ Needs FreeBSD bootstrap binary                          â”‚
â”‚    ...and many more!                                                         â”‚
â”‚                                                                              â”‚
â”‚    Problem: Need to maintain N different bootstrap binaries!                 â”‚
â”‚                                                                              â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                                              â”‚
â”‚  Zig&#39;s Solution with WebAssembly:                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚
â”‚                                                                              â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚                         â”‚   zig1.wasm     â”‚                                  â”‚
â”‚                         â”‚   (ONE file)    â”‚                                  â”‚
â”‚                         â”‚   ~3MB          â”‚                                  â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                                  â”‚                                           â”‚
â”‚                          wasm2c (transpile)                                  â”‚
â”‚                                  â”‚                                           â”‚
â”‚                                  â–¼                                           â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚                         â”‚    zig1.c       â”‚                                  â”‚
â”‚                         â”‚  (portable C)   â”‚                                  â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                                  â”‚                                           â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚              â”‚                   â”‚                   â”‚                       â”‚
â”‚              â–¼                   â–¼                   â–¼                       â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚    â”‚  Linux x86_64   â”‚ â”‚  macOS ARM64    â”‚ â”‚    Windows      â”‚              â”‚
â”‚    â”‚     zig1        â”‚ â”‚     zig1        â”‚ â”‚     zig1        â”‚              â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                              â”‚
â”‚    âœ“ ONE wasm file works EVERYWHERE with a C compiler!                       â”‚
â”‚    âœ“ Deterministic: same wasm â†’ same C â†’ same behavior                       â”‚
â”‚    âœ“ Verifiable: binary is in the git repo                                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h2 class="relative group">Stage 0: The C Bootstrap (<code>bootstrap.c</code>)
    <div id="stage-0-the-c-bootstrap-bootstrapc" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#stage-0-the-c-bootstrap-bootstrapc" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p><strong>Location</strong>: <code>bootstrap.c</code> (200 lines)</p>
<p>This tiny C file orchestrates the entire bootstrap. Let&rsquo;s examine it step by step.</p>

<h3 class="relative group">The Entry Point
    <div id="the-entry-point" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#the-entry-point" aria-label="Anchor">#</a>
    </span>
    
</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">cc</span> <span class="o">=</span> <span class="nf">get_c_compiler</span><span class="p">();</span>       <span class="c1">// Uses $CC or defaults to &#34;cc&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">host_triple</span> <span class="o">=</span> <span class="nf">get_host_triple</span><span class="p">();</span>  <span class="c1">// e.g., &#34;x86_64-linux&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Step 1: Build the wasm2c tool
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// Step 2: Convert zig1.wasm to C
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// Step 3: Compile zig1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// Step 4: Generate config.zig
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// Step 5: Use zig1 to compile zig2.c
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// Step 6: Build compiler_rt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// Step 7: Compile final zig2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
<h3 class="relative group">Host Detection (Actual Source Code)
    <div id="host-detection-actual-source-code" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#host-detection-actual-source-code" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>The bootstrap needs to know what platform it&rsquo;s running on:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">get_host_os</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">host_os</span> <span class="o">=</span> <span class="nf">getenv</span><span class="p">(</span><span class="s">&#34;ZIG_HOST_TARGET_OS&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">host_os</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="k">return</span> <span class="n">host_os</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">#if defined(__WIN32__)
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    <span class="k">return</span> <span class="s">&#34;windows&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">#elif defined(__APPLE__)
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    <span class="k">return</span> <span class="s">&#34;macos&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">#elif defined(__linux__)
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    <span class="k">return</span> <span class="s">&#34;linux&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">#elif defined(__FreeBSD__)
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    <span class="k">return</span> <span class="s">&#34;freebsd&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">#elif defined(__DragonFly__)
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    <span class="k">return</span> <span class="s">&#34;dragonfly&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">#elif defined(__HAIKU__)
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    <span class="k">return</span> <span class="s">&#34;haiku&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">#else
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    <span class="nf">panic</span><span class="p">(</span><span class="s">&#34;unknown host os, specify with ZIG_HOST_TARGET_OS&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">#endif
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">get_host_arch</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">host_arch</span> <span class="o">=</span> <span class="nf">getenv</span><span class="p">(</span><span class="s">&#34;ZIG_HOST_TARGET_ARCH&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">host_arch</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="k">return</span> <span class="n">host_arch</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">#if defined(__x86_64__)
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    <span class="k">return</span> <span class="s">&#34;x86_64&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">#elif defined(__aarch64__)
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    <span class="k">return</span> <span class="s">&#34;aarch64&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">#else
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    <span class="nf">panic</span><span class="p">(</span><span class="s">&#34;unknown host arch, specify with ZIG_HOST_TARGET_ARCH&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">#endif
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">get_host_triple</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">host_triple</span> <span class="o">=</span> <span class="nf">getenv</span><span class="p">(</span><span class="s">&#34;ZIG_HOST_TARGET_TRIPLE&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">host_triple</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="k">return</span> <span class="n">host_triple</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">static</span> <span class="kt">char</span> <span class="n">global_buffer</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nf">sprintf</span><span class="p">(</span><span class="n">global_buffer</span><span class="p">,</span> <span class="s">&#34;%s-%s%s&#34;</span><span class="p">,</span> <span class="nf">get_host_arch</span><span class="p">(),</span> <span class="nf">get_host_os</span><span class="p">(),</span> <span class="nf">get_host_abi</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">global_buffer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
<h3 class="relative group">Process Execution Helper
    <div id="process-execution-helper" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#process-execution-helper" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>The bootstrap runs several child processes:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">(</span><span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">pid_t</span> <span class="n">pid</span> <span class="o">=</span> <span class="nf">fork</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nf">panic</span><span class="p">(</span><span class="s">&#34;fork failed&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// child process
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">execvp</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">argv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// parent waits for child
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">status</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">waitpid</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">status</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nf">WIFEXITED</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="nf">panic</span><span class="p">(</span><span class="s">&#34;child process crashed&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nf">WEXITSTATUS</span><span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nf">panic</span><span class="p">(</span><span class="s">&#34;child process failed&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">void</span> <span class="nf">print_and_run</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Print command for visibility
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">arg</span> <span class="o">=</span> <span class="n">argv</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="o">*</span><span class="n">arg</span><span class="p">;</span> <span class="n">arg</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#34; %s&#34;</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nf">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">run</span><span class="p">((</span><span class="kt">char</span> <span class="o">**</span><span class="p">)</span><span class="n">argv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
<h3 class="relative group">Step 1: Build the WebAssembly-to-C Transpiler
    <div id="step-1-build-the-webassembly-to-c-transpiler" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#step-1-build-the-webassembly-to-c-transpiler" aria-label="Anchor">#</a>
    </span>
    
</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">child_argv</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">cc</span><span class="p">,</span> <span class="s">&#34;-o&#34;</span><span class="p">,</span> <span class="s">&#34;zig-wasm2c&#34;</span><span class="p">,</span> <span class="s">&#34;stage1/wasm2c.c&#34;</span><span class="p">,</span> <span class="s">&#34;-O2&#34;</span><span class="p">,</span> <span class="s">&#34;-std=c99&#34;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="nf">print_and_run</span><span class="p">(</span><span class="n">child_argv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This compiles the <code>wasm2c</code> tool, which can read WebAssembly binary format and output equivalent C code.</p>

<h3 class="relative group">Step 2: Convert zig1.wasm to C
    <div id="step-2-convert-zig1wasm-to-c" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#step-2-convert-zig1wasm-to-c" aria-label="Anchor">#</a>
    </span>
    
</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">child_argv</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;./zig-wasm2c&#34;</span><span class="p">,</span> <span class="s">&#34;stage1/zig1.wasm&#34;</span><span class="p">,</span> <span class="s">&#34;zig1.c&#34;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="nf">print_and_run</span><span class="p">(</span><span class="n">child_argv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This produces <code>zig1.c</code> - a massive C file containing the entire Zig compiler!</p>

<h3 class="relative group">Step 3: Compile zig1
    <div id="step-3-compile-zig1" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#step-3-compile-zig1" aria-label="Anchor">#</a>
    </span>
    
</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">child_argv</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">cc</span><span class="p">,</span> <span class="s">&#34;-o&#34;</span><span class="p">,</span> <span class="s">&#34;zig1&#34;</span><span class="p">,</span> <span class="s">&#34;zig1.c&#34;</span><span class="p">,</span> <span class="s">&#34;stage1/wasi.c&#34;</span><span class="p">,</span> <span class="s">&#34;-std=c99&#34;</span><span class="p">,</span> <span class="s">&#34;-Os&#34;</span><span class="p">,</span> <span class="s">&#34;-lm&#34;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="nf">print_and_run</span><span class="p">(</span><span class="n">child_argv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Note the inclusion of <code>wasi.c</code> - this provides the system interface that the WebAssembly code expects.</p>

<h3 class="relative group">Step 4: Generate Build Configuration
    <div id="step-4-generate-build-configuration" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#step-4-generate-build-configuration" aria-label="Anchor">#</a>
    </span>
    
</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">FILE</span> <span class="o">*</span><span class="n">f</span> <span class="o">=</span> <span class="nf">fopen</span><span class="p">(</span><span class="s">&#34;config.zig&#34;</span><span class="p">,</span> <span class="s">&#34;wb&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nf">panic</span><span class="p">(</span><span class="s">&#34;unable to open config.zig for writing&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">zig_version</span> <span class="o">=</span> <span class="s">&#34;0.14.0-dev.bootstrap&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">written</span> <span class="o">=</span> <span class="nf">fprintf</span><span class="p">(</span><span class="n">f</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;pub const have_llvm = false;</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;pub const llvm_has_m68k = false;</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;pub const llvm_has_csky = false;</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;pub const llvm_has_arc = false;</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;pub const llvm_has_xtensa = false;</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;pub const version: [:0]const u8 = </span><span class="se">\&#34;</span><span class="s">%s</span><span class="se">\&#34;</span><span class="s">;</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;pub const semver = @import(</span><span class="se">\&#34;</span><span class="s">std</span><span class="se">\&#34;</span><span class="s">).SemanticVersion.parse(version) catch unreachable;</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;pub const enable_debug_extensions = false;</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;pub const enable_logging = false;</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;pub const enable_link_snapshots = false;</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;pub const enable_tracy = false;</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;pub const value_tracing = false;</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;pub const skip_non_native = false;</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;pub const debug_gpa = false;</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;pub const dev = .core;</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;pub const value_interpret_mode = .direct;</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">,</span> <span class="n">zig_version</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">written</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nf">panic</span><span class="p">(</span><span class="s">&#34;unable to write to config.zig file&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nf">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nf">panic</span><span class="p">(</span><span class="s">&#34;unable to finish writing to config.zig file&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This creates a minimal configuration that disables LLVM and other optional features.</p>

<h3 class="relative group">Step 5: Build zig2 Using zig1
    <div id="step-5-build-zig2-using-zig1" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#step-5-build-zig2-using-zig1" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>Here&rsquo;s where the magic happens - we use zig1 to compile the FULL Zig compiler source:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">child_argv</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;./zig1&#34;</span><span class="p">,</span> <span class="s">&#34;lib&#34;</span><span class="p">,</span> <span class="s">&#34;build-exe&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;-ofmt=c&#34;</span><span class="p">,</span>              <span class="c1">// Output C code (not machine code!)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="s">&#34;-lc&#34;</span><span class="p">,</span>                  <span class="c1">// Link libc
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="s">&#34;-OReleaseSmall&#34;</span><span class="p">,</span>       <span class="c1">// Optimize for size
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="s">&#34;--name&#34;</span><span class="p">,</span> <span class="s">&#34;zig2&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;-femit-bin=zig2.c&#34;</span><span class="p">,</span>    <span class="c1">// Output to zig2.c
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="s">&#34;-target&#34;</span><span class="p">,</span> <span class="n">host_triple</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;--dep&#34;</span><span class="p">,</span> <span class="s">&#34;build_options&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;--dep&#34;</span><span class="p">,</span> <span class="s">&#34;aro&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;-Mroot=src/main.zig&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;-Mbuild_options=config.zig&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;-Maro=lib/compiler/aro/aro.zig&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nb">NULL</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="nf">print_and_run</span><span class="p">(</span><span class="n">child_argv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The crucial flag here is <code>-ofmt=c</code> which tells Zig to output C code instead of machine code.</p>

<h3 class="relative group">Step 6: Build compiler_rt
    <div id="step-6-build-compiler_rt" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#step-6-build-compiler_rt" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>The compiler runtime library is also compiled to C:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">child_argv</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;./zig1&#34;</span><span class="p">,</span> <span class="s">&#34;lib&#34;</span><span class="p">,</span> <span class="s">&#34;build-obj&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;-ofmt=c&#34;</span><span class="p">,</span> <span class="s">&#34;-OReleaseSmall&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;--name&#34;</span><span class="p">,</span> <span class="s">&#34;compiler_rt&#34;</span><span class="p">,</span> <span class="s">&#34;-femit-bin=compiler_rt.c&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;-target&#34;</span><span class="p">,</span> <span class="n">host_triple</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;-Mroot=lib/compiler_rt.zig&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nb">NULL</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="nf">print_and_run</span><span class="p">(</span><span class="n">child_argv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
<h3 class="relative group">Step 7: Compile zig2 to Native Code
    <div id="step-7-compile-zig2-to-native-code" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#step-7-compile-zig2-to-native-code" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>Finally, we compile the generated C code to produce a native executable:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">child_argv</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">cc</span><span class="p">,</span> <span class="s">&#34;-o&#34;</span><span class="p">,</span> <span class="s">&#34;zig2&#34;</span><span class="p">,</span> <span class="s">&#34;zig2.c&#34;</span><span class="p">,</span> <span class="s">&#34;compiler_rt.c&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;-std=c99&#34;</span><span class="p">,</span> <span class="s">&#34;-O2&#34;</span><span class="p">,</span> <span class="s">&#34;-fno-stack-protector&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;-Istage1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="cp">#if defined(__APPLE__)
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>        <span class="s">&#34;-Wl,-stack_size,0x10000000&#34;</span><span class="p">,</span>   <span class="c1">// 256MB stack for macOS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#else
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>        <span class="s">&#34;-Wl,-z,stack-size=0x10000000&#34;</span><span class="p">,</span> <span class="c1">// 256MB stack for Linux
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#endif
</span></span></span><span class="line"><span class="cl"><span class="cp">#if defined(__GNUC__)
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>        <span class="s">&#34;-pthread&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="cp">#endif
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>        <span class="nb">NULL</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="nf">print_and_run</span><span class="p">(</span><span class="n">child_argv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>At this point, <code>zig2</code> is a fully functional Zig compiler!</p>

<h2 class="relative group">The WebAssembly-to-C Transpiler (<code>wasm2c.c</code>)
    <div id="the-webassembly-to-c-transpiler-wasm2cc" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#the-webassembly-to-c-transpiler-wasm2cc" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p><strong>Location</strong>: <code>stage1/wasm2c.c</code> (2,299 lines)</p>
<p>This is a sophisticated transpiler that converts WebAssembly bytecode to equivalent C code.</p>

<h3 class="relative group">Understanding WebAssembly Binary Format
    <div id="understanding-webassembly-binary-format" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#understanding-webassembly-binary-format" aria-label="Anchor">#</a>
    </span>
    
</h3>
<pre tabindex="0"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WEBASSEMBLY BINARY FORMAT                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         WASM FILE HEADER                               â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  Magic Number: 0x00 0x61 0x73 0x6D  (&#34;\0asm&#34;)                          â”‚ â”‚
â”‚  â”‚  Version:      0x01 0x00 0x00 0x00  (version 1)                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         SECTIONS                                       â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚   Section ID â”‚ Name       â”‚ Contents                                  â”‚ â”‚
â”‚  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚  â”‚      1      â”‚ Type       â”‚ Function type signatures                   â”‚ â”‚
â”‚  â”‚      2      â”‚ Import     â”‚ Imported functions, tables, memories       â”‚ â”‚
â”‚  â”‚      3      â”‚ Function   â”‚ Function declarations (type indices)       â”‚ â”‚
â”‚  â”‚      4      â”‚ Table      â”‚ Table declarations                         â”‚ â”‚
â”‚  â”‚      5      â”‚ Memory     â”‚ Linear memory declarations                 â”‚ â”‚
â”‚  â”‚      6      â”‚ Global     â”‚ Global variable declarations               â”‚ â”‚
â”‚  â”‚      7      â”‚ Export     â”‚ Exported functions, tables, memories       â”‚ â”‚
â”‚  â”‚      8      â”‚ Start      â”‚ Start function index (optional)            â”‚ â”‚
â”‚  â”‚      9      â”‚ Element    â”‚ Table element initializers                 â”‚ â”‚
â”‚  â”‚     10      â”‚ Code       â”‚ Function bodies (the actual code!)         â”‚ â”‚
â”‚  â”‚     11      â”‚ Data       â”‚ Data segment initializers                  â”‚ â”‚
â”‚  â”‚     12      â”‚ DataCount  â”‚ Number of data segments                    â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 class="relative group">WebAssembly Section IDs (from <code>wasm.h</code>)
    <div id="webassembly-section-ids-from-wasmh" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#webassembly-section-ids-from-wasmh" aria-label="Anchor">#</a>
    </span>
    
</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">enum</span> <span class="n">WasmSectionId</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">WasmSectionId_type</span>      <span class="o">=</span>  <span class="mi">1</span><span class="p">,</span>   <span class="c1">// Function signatures
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmSectionId_import</span>    <span class="o">=</span>  <span class="mi">2</span><span class="p">,</span>   <span class="c1">// Imported functions
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmSectionId_func</span>      <span class="o">=</span>  <span class="mi">3</span><span class="p">,</span>   <span class="c1">// Function declarations
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmSectionId_table</span>     <span class="o">=</span>  <span class="mi">4</span><span class="p">,</span>   <span class="c1">// Function tables
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmSectionId_mem</span>       <span class="o">=</span>  <span class="mi">5</span><span class="p">,</span>   <span class="c1">// Memory declarations
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmSectionId_global</span>    <span class="o">=</span>  <span class="mi">6</span><span class="p">,</span>   <span class="c1">// Global variables
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmSectionId_export</span>    <span class="o">=</span>  <span class="mi">7</span><span class="p">,</span>   <span class="c1">// Exported functions
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmSectionId_start</span>     <span class="o">=</span>  <span class="mi">8</span><span class="p">,</span>   <span class="c1">// Entry point
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmSectionId_elem</span>      <span class="o">=</span>  <span class="mi">9</span><span class="p">,</span>   <span class="c1">// Table initializers
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmSectionId_code</span>      <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>   <span class="c1">// Function bodies
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmSectionId_data</span>      <span class="o">=</span> <span class="mi">11</span><span class="p">,</span>   <span class="c1">// Data segments
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmSectionId_datacount</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>   <span class="c1">// Data count
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
<h3 class="relative group">WebAssembly Value Types
    <div id="webassembly-value-types" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#webassembly-value-types" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>WebAssembly has a simple type system that maps cleanly to C:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">enum</span> <span class="n">WasmValType</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">WasmValType_i32</span>       <span class="o">=</span> <span class="o">-</span><span class="mh">0x01</span><span class="p">,</span>   <span class="c1">// 32-bit integer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmValType_i64</span>       <span class="o">=</span> <span class="o">-</span><span class="mh">0x02</span><span class="p">,</span>   <span class="c1">// 64-bit integer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmValType_f32</span>       <span class="o">=</span> <span class="o">-</span><span class="mh">0x03</span><span class="p">,</span>   <span class="c1">// 32-bit float
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmValType_f64</span>       <span class="o">=</span> <span class="o">-</span><span class="mh">0x04</span><span class="p">,</span>   <span class="c1">// 64-bit float
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmValType_v128</span>      <span class="o">=</span> <span class="o">-</span><span class="mh">0x05</span><span class="p">,</span>   <span class="c1">// 128-bit vector (SIMD)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmValType_funcref</span>   <span class="o">=</span> <span class="o">-</span><span class="mh">0x10</span><span class="p">,</span>   <span class="c1">// Function reference
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmValType_externref</span> <span class="o">=</span> <span class="o">-</span><span class="mh">0x11</span><span class="p">,</span>   <span class="c1">// External reference
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmValType_empty</span>     <span class="o">=</span> <span class="o">-</span><span class="mh">0x40</span><span class="p">,</span>   <span class="c1">// Void/empty
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// How wasm2c converts types to C:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">WasmValType_toC</span><span class="p">(</span><span class="k">enum</span> <span class="n">WasmValType</span> <span class="n">val_type</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">switch</span> <span class="p">(</span><span class="n">val_type</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="nl">WasmValType_i32</span><span class="p">:</span> <span class="k">return</span> <span class="s">&#34;uint32_t&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="nl">WasmValType_i64</span><span class="p">:</span> <span class="k">return</span> <span class="s">&#34;uint64_t&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="nl">WasmValType_f32</span><span class="p">:</span> <span class="k">return</span> <span class="s">&#34;float&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="nl">WasmValType_f64</span><span class="p">:</span> <span class="k">return</span> <span class="s">&#34;double&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="nl">WasmValType_funcref</span><span class="p">:</span> <span class="k">return</span> <span class="s">&#34;void (*)(void)&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="nl">WasmValType_externref</span><span class="p">:</span> <span class="k">return</span> <span class="s">&#34;void *&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">default</span><span class="o">:</span> <span class="nf">panic</span><span class="p">(</span><span class="s">&#34;unsupported value type&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
<h3 class="relative group">WebAssembly Opcodes
    <div id="webassembly-opcodes" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#webassembly-opcodes" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>WebAssembly has ~200 instructions. Here are the key ones:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">enum</span> <span class="n">WasmOpcode</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Control flow
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_unreachable</span>         <span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span>  <span class="c1">// Trap
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_nop</span>                 <span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>  <span class="c1">// No operation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_block</span>               <span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="c1">// Begin block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_loop</span>                <span class="o">=</span> <span class="mh">0x03</span><span class="p">,</span>  <span class="c1">// Begin loop
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_if</span>                  <span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="c1">// Begin if
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_else</span>                <span class="o">=</span> <span class="mh">0x05</span><span class="p">,</span>  <span class="c1">// Begin else
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_end</span>                 <span class="o">=</span> <span class="mh">0x0B</span><span class="p">,</span>  <span class="c1">// End block/loop/if
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_br</span>                  <span class="o">=</span> <span class="mh">0x0C</span><span class="p">,</span>  <span class="c1">// Branch
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_br_if</span>               <span class="o">=</span> <span class="mh">0x0D</span><span class="p">,</span>  <span class="c1">// Conditional branch
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_br_table</span>            <span class="o">=</span> <span class="mh">0x0E</span><span class="p">,</span>  <span class="c1">// Branch table (switch)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_return</span>              <span class="o">=</span> <span class="mh">0x0F</span><span class="p">,</span>  <span class="c1">// Return from function
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_call</span>                <span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span>  <span class="c1">// Call function
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_call_indirect</span>       <span class="o">=</span> <span class="mh">0x11</span><span class="p">,</span>  <span class="c1">// Indirect call
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Variable access
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_local_get</span>           <span class="o">=</span> <span class="mh">0x20</span><span class="p">,</span>  <span class="c1">// Get local variable
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_local_set</span>           <span class="o">=</span> <span class="mh">0x21</span><span class="p">,</span>  <span class="c1">// Set local variable
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_local_tee</span>           <span class="o">=</span> <span class="mh">0x22</span><span class="p">,</span>  <span class="c1">// Tee (get and set)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_global_get</span>          <span class="o">=</span> <span class="mh">0x23</span><span class="p">,</span>  <span class="c1">// Get global variable
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_global_set</span>          <span class="o">=</span> <span class="mh">0x24</span><span class="p">,</span>  <span class="c1">// Set global variable
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Memory operations
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_i32_load</span>            <span class="o">=</span> <span class="mh">0x28</span><span class="p">,</span>  <span class="c1">// Load i32 from memory
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_i64_load</span>            <span class="o">=</span> <span class="mh">0x29</span><span class="p">,</span>  <span class="c1">// Load i64 from memory
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_f32_load</span>            <span class="o">=</span> <span class="mh">0x2A</span><span class="p">,</span>  <span class="c1">// Load f32 from memory
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_f64_load</span>            <span class="o">=</span> <span class="mh">0x2B</span><span class="p">,</span>  <span class="c1">// Load f64 from memory
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_i32_store</span>           <span class="o">=</span> <span class="mh">0x36</span><span class="p">,</span>  <span class="c1">// Store i32 to memory
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_i64_store</span>           <span class="o">=</span> <span class="mh">0x37</span><span class="p">,</span>  <span class="c1">// Store i64 to memory
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_memory_grow</span>         <span class="o">=</span> <span class="mh">0x40</span><span class="p">,</span>  <span class="c1">// Grow memory
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Constants
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_i32_const</span>           <span class="o">=</span> <span class="mh">0x41</span><span class="p">,</span>  <span class="c1">// Push i32 constant
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_i64_const</span>           <span class="o">=</span> <span class="mh">0x42</span><span class="p">,</span>  <span class="c1">// Push i64 constant
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_f32_const</span>           <span class="o">=</span> <span class="mh">0x43</span><span class="p">,</span>  <span class="c1">// Push f32 constant
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_f64_const</span>           <span class="o">=</span> <span class="mh">0x44</span><span class="p">,</span>  <span class="c1">// Push f64 constant
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Arithmetic (i32)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_i32_add</span>             <span class="o">=</span> <span class="mh">0x6A</span><span class="p">,</span>  <span class="c1">// i32 addition
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_i32_sub</span>             <span class="o">=</span> <span class="mh">0x6B</span><span class="p">,</span>  <span class="c1">// i32 subtraction
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_i32_mul</span>             <span class="o">=</span> <span class="mh">0x6C</span><span class="p">,</span>  <span class="c1">// i32 multiplication
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_i32_div_s</span>           <span class="o">=</span> <span class="mh">0x6D</span><span class="p">,</span>  <span class="c1">// i32 signed division
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_i32_div_u</span>           <span class="o">=</span> <span class="mh">0x6E</span><span class="p">,</span>  <span class="c1">// i32 unsigned division
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_i32_and</span>             <span class="o">=</span> <span class="mh">0x71</span><span class="p">,</span>  <span class="c1">// i32 bitwise AND
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_i32_or</span>              <span class="o">=</span> <span class="mh">0x72</span><span class="p">,</span>  <span class="c1">// i32 bitwise OR
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_i32_xor</span>             <span class="o">=</span> <span class="mh">0x73</span><span class="p">,</span>  <span class="c1">// i32 bitwise XOR
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_i32_shl</span>             <span class="o">=</span> <span class="mh">0x74</span><span class="p">,</span>  <span class="c1">// i32 shift left
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_i32_shr_s</span>           <span class="o">=</span> <span class="mh">0x75</span><span class="p">,</span>  <span class="c1">// i32 signed shift right
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_i32_shr_u</span>           <span class="o">=</span> <span class="mh">0x76</span><span class="p">,</span>  <span class="c1">// i32 unsigned shift right
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Comparisons
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_i32_eqz</span>             <span class="o">=</span> <span class="mh">0x45</span><span class="p">,</span>  <span class="c1">// i32 equals zero
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_i32_eq</span>              <span class="o">=</span> <span class="mh">0x46</span><span class="p">,</span>  <span class="c1">// i32 equals
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_i32_ne</span>              <span class="o">=</span> <span class="mh">0x47</span><span class="p">,</span>  <span class="c1">// i32 not equals
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_i32_lt_s</span>            <span class="o">=</span> <span class="mh">0x48</span><span class="p">,</span>  <span class="c1">// i32 less than (signed)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_i32_lt_u</span>            <span class="o">=</span> <span class="mh">0x49</span><span class="p">,</span>  <span class="c1">// i32 less than (unsigned)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_i32_gt_s</span>            <span class="o">=</span> <span class="mh">0x4A</span><span class="p">,</span>  <span class="c1">// i32 greater than (signed)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">WasmOpcode_i32_gt_u</span>            <span class="o">=</span> <span class="mh">0x4B</span><span class="p">,</span>  <span class="c1">// i32 greater than (unsigned)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...and many more for i64, f32, f64
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
<h3 class="relative group">How wasm2c Generates C Code
    <div id="how-wasm2c-generates-c-code" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#how-wasm2c-generates-c-code" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>The transpiler maintains a virtual stack and generates C code for each instruction:</p>
<pre tabindex="0"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WASM2C TRANSPILATION PROCESS                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  WebAssembly Stack Machine           Equivalent C Code                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”‚
â”‚                                                                              â”‚
â”‚  i32.const 10                        uint32_t l0 = UINT32_C(10);            â”‚
â”‚  i32.const 20                        uint32_t l1 = UINT32_C(20);            â”‚
â”‚  i32.add                             uint32_t l2 = l0 + l1;                 â”‚
â”‚  local.set 0                         l3 = l2;                               â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                                              â”‚
â”‚  Stack Evolution:                    Generated Variables:                    â”‚
â”‚                                                                              â”‚
â”‚  i32.const 10:  [10]                 l0 = 10                                â”‚
â”‚  i32.const 20:  [10, 20]             l0 = 10, l1 = 20                       â”‚
â”‚  i32.add:       [30]                 l0 = 10, l1 = 20, l2 = l0+l1           â”‚
â”‚  local.set 0:   []                   local_0 = l2                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 class="relative group">Generated Helper Functions
    <div id="generated-helper-functions" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#generated-helper-functions" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>The output begins with portable helper functions:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// Byte swapping for endianness handling
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">static</span> <span class="kt">uint16_t</span> <span class="nf">i16_byteswap</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">src</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="kt">uint16_t</span><span class="p">)(</span><span class="kt">uint8_t</span><span class="p">)(</span><span class="n">src</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl">           <span class="p">(</span><span class="kt">uint16_t</span><span class="p">)(</span><span class="kt">uint8_t</span><span class="p">)(</span><span class="n">src</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">i32_byteswap</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">src</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="nf">i16_byteswap</span><span class="p">(</span><span class="n">src</span> <span class="o">&gt;&gt;</span>  <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl">           <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="nf">i16_byteswap</span><span class="p">(</span><span class="n">src</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&lt;&lt;</span>  <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">uint64_t</span> <span class="nf">i64_byteswap</span><span class="p">(</span><span class="kt">uint64_t</span> <span class="n">src</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="kt">uint64_t</span><span class="p">)</span><span class="nf">i32_byteswap</span><span class="p">(</span><span class="n">src</span> <span class="o">&gt;&gt;</span>  <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">32</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl">           <span class="p">(</span><span class="kt">uint64_t</span><span class="p">)</span><span class="nf">i32_byteswap</span><span class="p">(</span><span class="n">src</span> <span class="o">&gt;&gt;</span> <span class="mi">32</span><span class="p">)</span> <span class="o">&lt;&lt;</span>  <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Memory load functions (handle alignment)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">uint32_t</span> <span class="nf">load32_align0</span><span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">ptr</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="n">val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">val</span><span class="p">,</span> <span class="n">ptr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">val</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">val</span><span class="p">;</span>  <span class="c1">// byte swap added if big-endian
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Memory store functions
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">store32_align2</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">memcpy</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">val</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Bit manipulation (WebAssembly intrinsics)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">i32_popcnt</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">lhs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">lhs</span> <span class="o">=</span> <span class="n">lhs</span> <span class="o">-</span> <span class="p">((</span><span class="n">lhs</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nf">UINT32_C</span><span class="p">(</span><span class="mh">0x55555555</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="n">lhs</span> <span class="o">=</span> <span class="p">(</span><span class="n">lhs</span> <span class="o">&amp;</span> <span class="nf">UINT32_C</span><span class="p">(</span><span class="mh">0x33333333</span><span class="p">))</span> <span class="o">+</span> <span class="p">((</span><span class="n">lhs</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nf">UINT32_C</span><span class="p">(</span><span class="mh">0x33333333</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="n">lhs</span> <span class="o">=</span> <span class="p">(</span><span class="n">lhs</span> <span class="o">+</span> <span class="p">(</span><span class="n">lhs</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">))</span> <span class="o">&amp;</span> <span class="nf">UINT32_C</span><span class="p">(</span><span class="mh">0x0F0F0F0F</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">lhs</span> <span class="o">*</span> <span class="nf">UINT32_C</span><span class="p">(</span><span class="mh">0x01010101</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">i32_ctz</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">lhs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nf">i32_popcnt</span><span class="p">(</span><span class="o">~</span><span class="n">lhs</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lhs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">i32_clz</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">lhs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">lhs</span> <span class="o">=</span> <span class="nf">i32_byteswap</span><span class="p">(</span><span class="n">lhs</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">lhs</span> <span class="o">=</span> <span class="p">(</span><span class="n">lhs</span> <span class="o">&amp;</span> <span class="nf">UINT32_C</span><span class="p">(</span><span class="mh">0x0F0F0F0F</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span> <span class="o">|</span> <span class="p">(</span><span class="n">lhs</span> <span class="o">&amp;</span> <span class="nf">UINT32_C</span><span class="p">(</span><span class="mh">0xF0F0F0F0</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">lhs</span> <span class="o">=</span> <span class="p">(</span><span class="n">lhs</span> <span class="o">&amp;</span> <span class="nf">UINT32_C</span><span class="p">(</span><span class="mh">0x33333333</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span> <span class="o">|</span> <span class="p">(</span><span class="n">lhs</span> <span class="o">&amp;</span> <span class="nf">UINT32_C</span><span class="p">(</span><span class="mh">0xCCCCCCCC</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">lhs</span> <span class="o">=</span> <span class="p">(</span><span class="n">lhs</span> <span class="o">&amp;</span> <span class="nf">UINT32_C</span><span class="p">(</span><span class="mh">0x55555555</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="p">(</span><span class="n">lhs</span> <span class="o">&amp;</span> <span class="nf">UINT32_C</span><span class="p">(</span><span class="mh">0xAAAAAAAA</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nf">i32_ctz</span><span class="p">(</span><span class="n">lhs</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Memory growth (dynamic allocation)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">memory_grow</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="o">**</span><span class="n">m</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="n">r</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="n">new_p</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">n</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">new_p</span> <span class="o">&gt;</span> <span class="nf">UINT32_C</span><span class="p">(</span><span class="mh">0xFFFF</span><span class="p">))</span> <span class="k">return</span> <span class="nf">UINT32_C</span><span class="p">(</span><span class="mh">0xFFFFFFFF</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">new_m</span> <span class="o">=</span> <span class="o">*</span><span class="n">m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="n">new_c</span> <span class="o">=</span> <span class="o">*</span><span class="n">c</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">new_c</span> <span class="o">&lt;</span> <span class="n">new_p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">do</span> <span class="n">new_c</span> <span class="o">+=</span> <span class="n">new_c</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">8</span><span class="p">;</span> <span class="k">while</span> <span class="p">(</span><span class="n">new_c</span> <span class="o">&lt;</span> <span class="n">new_p</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">new_c</span> <span class="o">&gt;</span> <span class="nf">UINT32_C</span><span class="p">(</span><span class="mh">0xFFFF</span><span class="p">))</span> <span class="n">new_c</span> <span class="o">=</span> <span class="nf">UINT32_C</span><span class="p">(</span><span class="mh">0xFFFF</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">new_m</span> <span class="o">=</span> <span class="nf">realloc</span><span class="p">(</span><span class="n">new_m</span><span class="p">,</span> <span class="n">new_c</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">new_m</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="k">return</span> <span class="nf">UINT32_C</span><span class="p">(</span><span class="mh">0xFFFFFFFF</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">*</span><span class="n">m</span> <span class="o">=</span> <span class="n">new_m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">*</span><span class="n">c</span> <span class="o">=</span> <span class="n">new_c</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">new_p</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">new_m</span><span class="p">[</span><span class="n">r</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
<h3 class="relative group">Function Generation
    <div id="function-generation" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#function-generation" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>For each WebAssembly function, wasm2c generates a C function:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// Example: A WebAssembly function with signature (i32, i32) -&gt; i32
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">f42</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">l0</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">l1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="n">l2</span><span class="p">;</span>    <span class="c1">// local variable
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint32_t</span> <span class="n">l3</span><span class="p">;</span>    <span class="c1">// stack slot
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint32_t</span> <span class="n">l4</span><span class="p">;</span>    <span class="c1">// stack slot
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Function body (generated from opcodes)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">l3</span> <span class="o">=</span> <span class="n">l0</span><span class="p">;</span>                            <span class="c1">// local.get 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">l4</span> <span class="o">=</span> <span class="n">l1</span><span class="p">;</span>                            <span class="c1">// local.get 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">l2</span> <span class="o">=</span> <span class="n">l3</span> <span class="o">+</span> <span class="n">l4</span><span class="p">;</span>                       <span class="c1">// i32.add
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="n">l2</span><span class="p">;</span>                          <span class="c1">// return
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
<h2 class="relative group">WASI: The System Interface (<code>wasi.c</code>)
    <div id="wasi-the-system-interface-wasic" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#wasi-the-system-interface-wasic" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p><strong>Location</strong>: <code>stage1/wasi.c</code> (1,064 lines)</p>
<p>WASI (WebAssembly System Interface) provides system calls for the WebAssembly code. It&rsquo;s like a minimal operating system layer.</p>

<h3 class="relative group">WASI Architecture
    <div id="wasi-architecture" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#wasi-architecture" aria-label="Anchor">#</a>
    </span>
    
</h3>
<pre tabindex="0"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         WASI ARCHITECTURE                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                     WASM CODE (zig1.wasm)                               â”‚â”‚
â”‚  â”‚                                                                         â”‚â”‚
â”‚  â”‚   wants to: read files, write output, get args, allocate memory         â”‚â”‚
â”‚  â”‚                                                                         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                      â”‚                                       â”‚
â”‚                         WASI function calls                                  â”‚
â”‚                                      â”‚                                       â”‚
â”‚                                      â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                     WASI IMPLEMENTATION (wasi.c)                        â”‚â”‚
â”‚  â”‚                                                                         â”‚â”‚
â”‚  â”‚   fd_read()      - Read from file descriptors                           â”‚â”‚
â”‚  â”‚   fd_write()     - Write to file descriptors                            â”‚â”‚
â”‚  â”‚   fd_seek()      - Seek in files                                        â”‚â”‚
â”‚  â”‚   fd_close()     - Close file descriptors                               â”‚â”‚
â”‚  â”‚   path_open()    - Open files by path                                   â”‚â”‚
â”‚  â”‚   args_get()     - Get command line arguments                           â”‚â”‚
â”‚  â”‚   clock_time_get()- Get current time                                    â”‚â”‚
â”‚  â”‚   random_get()   - Get random bytes                                     â”‚â”‚
â”‚  â”‚   proc_exit()    - Exit process                                         â”‚â”‚
â”‚  â”‚                                                                         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                      â”‚                                       â”‚
â”‚                        Native system calls                                   â”‚
â”‚                                      â”‚                                       â”‚
â”‚                                      â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                     HOST OPERATING SYSTEM                               â”‚â”‚
â”‚  â”‚                                                                         â”‚â”‚
â”‚  â”‚   Linux / macOS / Windows / FreeBSD / etc.                              â”‚â”‚
â”‚  â”‚                                                                         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 class="relative group">WASI Error Codes
    <div id="wasi-error-codes" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#wasi-error-codes" aria-label="Anchor">#</a>
    </span>
    
</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">enum</span> <span class="n">wasi_errno</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">wasi_errno_success</span>        <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>   <span class="c1">// Success
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">wasi_errno_2big</span>           <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>   <span class="c1">// Argument list too long
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">wasi_errno_acces</span>          <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>   <span class="c1">// Permission denied
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">wasi_errno_badf</span>           <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>   <span class="c1">// Bad file descriptor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">wasi_errno_exist</span>          <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>  <span class="c1">// File exists
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">wasi_errno_inval</span>          <span class="o">=</span> <span class="mi">28</span><span class="p">,</span>  <span class="c1">// Invalid argument
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">wasi_errno_io</span>             <span class="o">=</span> <span class="mi">29</span><span class="p">,</span>  <span class="c1">// I/O error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">wasi_errno_isdir</span>          <span class="o">=</span> <span class="mi">31</span><span class="p">,</span>  <span class="c1">// Is a directory
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">wasi_errno_noent</span>          <span class="o">=</span> <span class="mi">44</span><span class="p">,</span>  <span class="c1">// No such file or directory
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">wasi_errno_nomem</span>          <span class="o">=</span> <span class="mi">48</span><span class="p">,</span>  <span class="c1">// Out of memory
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">wasi_errno_notdir</span>         <span class="o">=</span> <span class="mi">54</span><span class="p">,</span>  <span class="c1">// Not a directory
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ... and many more
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
<h3 class="relative group">File Descriptor Management
    <div id="file-descriptor-management" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#file-descriptor-management" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>WASI maintains a table of open file descriptors:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="n">fd_len</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="k">struct</span> <span class="n">FileDescriptor</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="n">de</span><span class="p">;</span>                      <span class="c1">// Directory entry index
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">enum</span> <span class="n">wasi_fdflags</span> <span class="n">fdflags</span><span class="p">;</span>        <span class="c1">// Flags (append, sync, etc.)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">;</span>                     <span class="c1">// Underlying C FILE*
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint64_t</span> <span class="n">fs_rights_inheriting</span><span class="p">;</span>    <span class="c1">// Capability rights
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> <span class="o">*</span><span class="n">fds</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Standard file descriptors are pre-opened:
</span></span></span><span class="line"><span class="cl"><span class="c1">// fd 0 = stdin
</span></span></span><span class="line"><span class="cl"><span class="c1">// fd 1 = stdout
</span></span></span><span class="line"><span class="cl"><span class="c1">// fd 2 = stderr
</span></span></span><span class="line"><span class="cl"><span class="c1">// fd 3+ = user-opened files
</span></span></span></code></pre></td></tr></table>
</div>
</div>
<h3 class="relative group">Key WASI Functions
    <div id="key-wasi-functions" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#key-wasi-functions" aria-label="Anchor">#</a>
    </span>
    
</h3>

<h4 class="relative group">Reading Files
    <div id="reading-files" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#reading-files" aria-label="Anchor">#</a>
    </span>
    
</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">uint32_t</span> <span class="nf">wasi_snapshot_preview1_fd_read</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="n">fd</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="n">iovs</span><span class="p">,</span>         <span class="c1">// Scatter-gather buffers
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint32_t</span> <span class="n">iovs_len</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="n">res_size</span>      <span class="c1">// Output: bytes read
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint8_t</span> <span class="o">*</span><span class="k">const</span> <span class="n">m</span> <span class="o">=</span> <span class="o">*</span><span class="n">wasm_memory</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">struct</span> <span class="n">wasi_ciovec</span> <span class="o">*</span><span class="n">iovs_ptr</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">wasi_ciovec</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">m</span><span class="p">[</span><span class="n">iovs</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">res_size_ptr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint32_t</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">m</span><span class="p">[</span><span class="n">res_size</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">fd</span> <span class="o">&gt;=</span> <span class="n">fd_len</span> <span class="o">||</span> <span class="n">fds</span><span class="p">[</span><span class="n">fd</span><span class="p">].</span><span class="n">de</span> <span class="o">&gt;=</span> <span class="n">de_len</span><span class="p">)</span> <span class="k">return</span> <span class="n">wasi_errno_badf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">fds</span><span class="p">[</span><span class="n">fd</span><span class="p">].</span><span class="n">stream</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">store32_align2</span><span class="p">(</span><span class="n">res_size_ptr</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">wasi_errno_success</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">size_t</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">uint32_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">iovs_len</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint32_t</span> <span class="n">len</span> <span class="o">=</span> <span class="nf">load32_align2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">iovs_ptr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">len</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">size_t</span> <span class="n">read_size</span> <span class="o">=</span> <span class="nf">fread</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="o">&amp;</span><span class="n">m</span><span class="p">[</span><span class="nf">load32_align2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">iovs_ptr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ptr</span><span class="p">)],</span>
</span></span><span class="line"><span class="cl">            <span class="mi">1</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">fds</span><span class="p">[</span><span class="n">fd</span><span class="p">].</span><span class="n">stream</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">size</span> <span class="o">+=</span> <span class="n">read_size</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">read_size</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">store32_align2</span><span class="p">(</span><span class="n">res_size_ptr</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">wasi_errno_success</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
<h4 class="relative group">Writing Files
    <div id="writing-files" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#writing-files" aria-label="Anchor">#</a>
    </span>
    
</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">uint32_t</span> <span class="nf">wasi_snapshot_preview1_fd_write</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="n">fd</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="n">iovs</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="n">iovs_len</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="n">res_size</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint8_t</span> <span class="o">*</span><span class="k">const</span> <span class="n">m</span> <span class="o">=</span> <span class="o">*</span><span class="n">wasm_memory</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">struct</span> <span class="n">wasi_ciovec</span> <span class="o">*</span><span class="n">iovs_ptr</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">wasi_ciovec</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">m</span><span class="p">[</span><span class="n">iovs</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">res_size_ptr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint32_t</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">m</span><span class="p">[</span><span class="n">res_size</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">fd</span> <span class="o">&gt;=</span> <span class="n">fd_len</span> <span class="o">||</span> <span class="n">fds</span><span class="p">[</span><span class="n">fd</span><span class="p">].</span><span class="n">de</span> <span class="o">&gt;=</span> <span class="n">de_len</span><span class="p">)</span> <span class="k">return</span> <span class="n">wasi_errno_badf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">size_t</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">uint32_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">iovs_len</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint32_t</span> <span class="n">len</span> <span class="o">=</span> <span class="nf">load32_align2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">iovs_ptr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">len</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">size_t</span> <span class="n">written_size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">fds</span><span class="p">[</span><span class="n">fd</span><span class="p">].</span><span class="n">stream</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">written_size</span> <span class="o">=</span> <span class="nf">fwrite</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="o">&amp;</span><span class="n">m</span><span class="p">[</span><span class="nf">load32_align2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">iovs_ptr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ptr</span><span class="p">)],</span>
</span></span><span class="line"><span class="cl">                <span class="mi">1</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">fds</span><span class="p">[</span><span class="n">fd</span><span class="p">].</span><span class="n">stream</span>
</span></span><span class="line"><span class="cl">            <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="cl">            <span class="n">written_size</span> <span class="o">=</span> <span class="n">len</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">size</span> <span class="o">+=</span> <span class="n">written_size</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">written_size</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">store32_align2</span><span class="p">(</span><span class="n">res_size_ptr</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">wasi_errno_success</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
<h4 class="relative group">Getting Command Line Arguments
    <div id="getting-command-line-arguments" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#getting-command-line-arguments" aria-label="Anchor">#</a>
    </span>
    
</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">uint32_t</span> <span class="nf">wasi_snapshot_preview1_args_get</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">argv</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">argv_buf</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint8_t</span> <span class="o">*</span><span class="k">const</span> <span class="n">m</span> <span class="o">=</span> <span class="o">*</span><span class="n">wasm_memory</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">argv_ptr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint32_t</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">m</span><span class="p">[</span><span class="n">argv</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="o">*</span><span class="n">argv_buf_ptr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">m</span><span class="p">[</span><span class="n">argv_buf</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">c_argc</span> <span class="o">=</span> <span class="n">global_argc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="o">**</span><span class="n">c_argv</span> <span class="o">=</span> <span class="n">global_argv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="n">dst_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="n">argv_buf_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">src_i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">src_i</span> <span class="o">&lt;</span> <span class="n">c_argc</span><span class="p">;</span> <span class="n">src_i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">src_i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>  <span class="c1">// Skip lib path argument
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">store32_align2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argv_ptr</span><span class="p">[</span><span class="n">dst_i</span><span class="p">],</span> <span class="n">argv_buf</span> <span class="o">+</span> <span class="n">argv_buf_i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">dst_i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nf">strcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argv_buf_ptr</span><span class="p">[</span><span class="n">argv_buf_i</span><span class="p">],</span> <span class="n">c_argv</span><span class="p">[</span><span class="n">src_i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="n">argv_buf_i</span> <span class="o">+=</span> <span class="nf">strlen</span><span class="p">(</span><span class="n">c_argv</span><span class="p">[</span><span class="n">src_i</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">wasi_errno_success</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
<h4 class="relative group">Process Exit
    <div id="process-exit" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#process-exit" aria-label="Anchor">#</a>
    </span>
    
</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">wasi_snapshot_preview1_proc_exit</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">rval</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">exit</span><span class="p">(</span><span class="n">rval</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
<h4 class="relative group">Getting Random Bytes
    <div id="getting-random-bytes" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#getting-random-bytes" aria-label="Anchor">#</a>
    </span>
    
</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">uint32_t</span> <span class="nf">wasi_snapshot_preview1_random_get</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">buf</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">buf_len</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint8_t</span> <span class="o">*</span><span class="k">const</span> <span class="n">m</span> <span class="o">=</span> <span class="o">*</span><span class="n">wasm_memory</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">buf_ptr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint8_t</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">m</span><span class="p">[</span><span class="n">buf</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">uint32_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">buf_len</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">buf_ptr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint8_t</span><span class="p">)</span><span class="nf">rand</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">wasi_errno_success</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
<h4 class="relative group">Getting Time
    <div id="getting-time" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#getting-time" aria-label="Anchor">#</a>
    </span>
    
</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">uint32_t</span> <span class="nf">wasi_snapshot_preview1_clock_time_get</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="n">id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint64_t</span> <span class="n">precision</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="n">res_timestamp</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint8_t</span> <span class="o">*</span><span class="k">const</span> <span class="n">m</span> <span class="o">=</span> <span class="o">*</span><span class="n">wasm_memory</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint64_t</span> <span class="o">*</span><span class="n">res_timestamp_ptr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint64_t</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">m</span><span class="p">[</span><span class="n">res_timestamp</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">switch</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="nl">wasi_clockid_realtime</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// Return nanoseconds since Unix epoch
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nf">store64_align3</span><span class="p">(</span><span class="n">res_timestamp_ptr</span><span class="p">,</span> <span class="nf">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">)</span> <span class="o">*</span> <span class="nf">UINT64_C</span><span class="p">(</span><span class="mi">1000000000</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="nl">wasi_clockid_monotonic</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="nl">wasi_clockid_process_cputime_id</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="nl">wasi_clockid_thread_cputime_id</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// Return process CPU time in nanoseconds
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nf">store64_align3</span><span class="p">(</span><span class="n">res_timestamp_ptr</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nf">clock</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="nf">UINT64_C</span><span class="p">(</span><span class="mi">1000000000</span><span class="p">)</span> <span class="o">/</span> <span class="n">CLOCKS_PER_SEC</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">default</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">wasi_errno_inval</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">wasi_errno_success</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
<h2 class="relative group">The C Backend: How Zig Outputs C
    <div id="the-c-backend-how-zig-outputs-c" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#the-c-backend-how-zig-outputs-c" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>When zig1 runs with <code>-ofmt=c</code>, it uses Zig&rsquo;s C backend to generate portable C code. This is a critical feature that enables the bootstrap.</p>

<h3 class="relative group">Example Transformation
    <div id="example-transformation" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#example-transformation" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>Given Zig code:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-zig" data-lang="zig"><span class="line"><span class="cl"><span class="kr">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="o">:</span><span class="w"> </span><span class="kt">u32</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">:</span><span class="w"> </span><span class="kt">u32</span><span class="p">)</span><span class="w"> </span><span class="kt">u32</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>The C backend generates:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="nf">zig_add</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="k">const</span> <span class="n">a</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="k">const</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="n">zig_tmp_0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">zig_tmp_0</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">zig_tmp_0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
<h3 class="relative group">Why C Output?
    <div id="why-c-output" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#why-c-output" aria-label="Anchor">#</a>
    </span>
    
</h3>
<pre tabindex="0"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WHY C AS AN INTERMEDIATE FORMAT?                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  1. UNIVERSALITY                                                             â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                            â”‚
â”‚     C compilers exist for EVERY platform                                     â”‚
â”‚     No need for LLVM or custom backends                                      â”‚
â”‚                                                                              â”‚
â”‚  2. PORTABILITY                                                              â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                              â”‚
â”‚     Generated C is standard C99                                              â”‚
â”‚     Works with gcc, clang, MSVC, tcc, etc.                                  â”‚
â”‚                                                                              â”‚
â”‚  3. VERIFIABILITY                                                            â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                            â”‚
â”‚     Generated C is human-readable                                            â”‚
â”‚     Can inspect exactly what Zig compiles to                                â”‚
â”‚                                                                              â”‚
â”‚  4. DEBUGGING                                                                â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                â”‚
â”‚     Can debug the generated C with standard tools                            â”‚
â”‚     Easier to diagnose codegen issues                                        â”‚
â”‚                                                                              â”‚
â”‚  5. BOOTSTRAP                                                                â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                â”‚
â”‚     Breaks the circular dependency                                           â”‚
â”‚     Zig can compile itself to C, then C compiler builds it                  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h2 class="relative group">Complete Bootstrap Timeline
    <div id="complete-bootstrap-timeline" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#complete-bootstrap-timeline" aria-label="Anchor">#</a>
    </span>
    
</h2>
<pre tabindex="0"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    COMPLETE BOOTSTRAP TIMELINE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  TIME         ACTION                          ARTIFACT                       â”‚
â”‚  â”€â”€â”€â”€         â”€â”€â”€â”€â”€â”€                          â”€â”€â”€â”€â”€â”€â”€â”€                       â”‚
â”‚                                                                              â”‚
â”‚  T+0s         Start: run bootstrap.c                                        â”‚
â”‚               â”‚                                                              â”‚
â”‚  T+1s         cc stage1/wasm2c.c â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ zig-wasm2c                    â”‚
â”‚               â”‚                                                              â”‚
â”‚  T+2s         ./zig-wasm2c zig1.wasm â”€â”€â”€â”€â”€â”€â”€â–¶ zig1.c                        â”‚
â”‚               â”‚                               (~100MB of C code!)            â”‚
â”‚               â”‚                                                              â”‚
â”‚  T+30s        cc zig1.c wasi.c â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ zig1                          â”‚
â”‚               â”‚                               (First Zig compiler!)          â”‚
â”‚               â”‚                                                              â”‚
â”‚  T+31s        Generate config.zig                                            â”‚
â”‚               â”‚                                                              â”‚
â”‚  T+60s        ./zig1 src/main.zig -ofmt=c â”€â”€â–¶ zig2.c                        â”‚
â”‚               â”‚                               (Full compiler as C)           â”‚
â”‚               â”‚                                                              â”‚
â”‚  T+90s        ./zig1 compiler_rt.zig â”€â”€â”€â”€â”€â”€â”€â–¶ compiler_rt.c                 â”‚
â”‚               â”‚                                                              â”‚
â”‚  T+120s       cc zig2.c compiler_rt.c â”€â”€â”€â”€â”€â”€â–¶ zig2                          â”‚
â”‚               â”‚                               (Full native compiler!)        â”‚
â”‚               â”‚                                                              â”‚
â”‚  T+121s       Bootstrap complete!                                            â”‚
â”‚               â”‚                                                              â”‚
â”‚  (optional)   ./zig2 build â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ stage3/bin/zig                â”‚
â”‚                                               (Production compiler)          â”‚
â”‚                                                                              â”‚
â”‚  Total time: ~2 minutes on modern hardware                                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h2 class="relative group">Key Design Decisions
    <div id="key-design-decisions" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#key-design-decisions" aria-label="Anchor">#</a>
    </span>
    
</h2>

<h3 class="relative group">1. Minimal Dependencies
    <div id="1-minimal-dependencies" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#1-minimal-dependencies" aria-label="Anchor">#</a>
    </span>
    
</h3>
<pre tabindex="0"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BOOTSTRAP DEPENDENCIES                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Required:                                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                   â”‚
â”‚  âœ“ C99 compiler (cc, gcc, clang, tcc, etc.)                                 â”‚
â”‚  âœ“ Standard C library (libc)                                                 â”‚
â”‚  âœ“ Basic POSIX environment (fork, exec, wait)                               â”‚
â”‚                                                                              â”‚
â”‚  NOT Required:                                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                              â”‚
â”‚  âœ— LLVM                                                                      â”‚
â”‚  âœ— CMake                                                                     â”‚
â”‚  âœ— Python                                                                    â”‚
â”‚  âœ— Make                                                                      â”‚
â”‚  âœ— Any specific compiler version                                            â”‚
â”‚  âœ— Internet connection                                                       â”‚
â”‚                                                                              â”‚
â”‚  Result: Can bootstrap on almost any Unix-like system!                       â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 class="relative group">2. Deterministic Builds
    <div id="2-deterministic-builds" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#2-deterministic-builds" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>The same <code>zig1.wasm</code> produces the same results everywhere:</p>
<pre tabindex="0"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DETERMINISM GUARANTEE                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  zig1.wasm (in git)                                                          â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â–¼                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚  Linux x64  â”‚    â”‚   macOS M1  â”‚    â”‚  FreeBSD    â”‚                      â”‚
â”‚  â”‚             â”‚    â”‚             â”‚    â”‚             â”‚                      â”‚
â”‚  â”‚  wasm2c    â”‚    â”‚  wasm2c    â”‚    â”‚  wasm2c    â”‚                      â”‚
â”‚  â”‚     â†“       â”‚    â”‚     â†“       â”‚    â”‚     â†“       â”‚                      â”‚
â”‚  â”‚  zig1.c     â”‚    â”‚  zig1.c     â”‚    â”‚  zig1.c     â”‚                      â”‚
â”‚  â”‚             â”‚    â”‚             â”‚    â”‚             â”‚                      â”‚
â”‚  â”‚  IDENTICAL  â”‚====â”‚  IDENTICAL  â”‚====â”‚  IDENTICAL  â”‚                      â”‚
â”‚  â”‚             â”‚    â”‚             â”‚    â”‚             â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                              â”‚
â”‚  The generated C code is byte-for-byte identical!                            â”‚
â”‚  (Only native compilation introduces platform differences)                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 class="relative group">3. Self-Improving Compilation
    <div id="3-self-improving-compilation" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#3-self-improving-compilation" aria-label="Anchor">#</a>
    </span>
    
</h3>
<p>Each stage produces a more capable compiler:</p>
<pre tabindex="0"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    COMPILER CAPABILITY PROGRESSION                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Stage      â”‚ Source    â”‚ Backend  â”‚ Speed   â”‚ Features                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  zig1       â”‚ zig1.wasm â”‚ wasm2c   â”‚ Slow    â”‚ Minimal (C output only)      â”‚
â”‚  zig2       â”‚ zig2.c    â”‚ C native â”‚ Medium  â”‚ Full (no LLVM)               â”‚
â”‚  zig3/stage3â”‚ Zig nativeâ”‚ Native   â”‚ Fast    â”‚ Full + LLVM optimizations    â”‚
â”‚                                                                              â”‚
â”‚  Performance improvement: ~100x from zig1 to zig3                            â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h2 class="relative group">Updating the Bootstrap
    <div id="updating-the-bootstrap" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#updating-the-bootstrap" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>When Zig developers make changes to the compiler, they may need to update <code>zig1.wasm</code>:</p>
<pre tabindex="0"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UPDATING THE BOOTSTRAP                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  1. Developer makes changes to compiler source                               â”‚
â”‚                                                                              â”‚
â”‚  2. Build new compiler with existing stage3:                                 â”‚
â”‚     $ zig build                                                              â”‚
â”‚                                                                              â”‚
â”‚  3. Use new compiler to build WASM version:                                  â”‚
â”‚     $ ./zig-out/bin/zig build \                                             â”‚
â”‚         -Dtarget=wasm32-wasi \                                              â”‚
â”‚         -Doptimize=ReleaseSmall                                             â”‚
â”‚                                                                              â”‚
â”‚  4. Test that bootstrap still works:                                         â”‚
â”‚     $ rm -rf zig1 zig2 zig1.c zig2.c                                        â”‚
â”‚     $ cc bootstrap.c -o bootstrap &amp;&amp; ./bootstrap                             â”‚
â”‚                                                                              â”‚
â”‚  5. Replace zig1.wasm in repository:                                         â”‚
â”‚     $ cp zig-out/bin/zig.wasm stage1/zig1.wasm                              â”‚
â”‚                                                                              â”‚
â”‚  6. Commit the new zig1.wasm                                                 â”‚
â”‚                                                                              â”‚
â”‚  This process is called &#34;updating the bootstrap&#34;                             â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h2 class="relative group">Historical Context
    <div id="historical-context" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#historical-context" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>The bootstrap design evolved over Zig&rsquo;s development:</p>
<pre tabindex="0"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BOOTSTRAP EVOLUTION                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Era 1: C++ Bootstrap (2015-2020)                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚
â”‚  - Original Zig compiler written in C++                                      â”‚
â”‚  - LLVM required for all builds                                              â”‚
â”‚  - Platform support limited by LLVM availability                             â”‚
â”‚                                                                              â”‚
â”‚  Era 2: Self-Hosted Development (2020-2022)                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
â”‚  - Parallel self-hosted compiler development                                 â”‚
â”‚  - C++ version maintained alongside                                          â”‚
â”‚  - Gradual feature parity                                                    â”‚
â”‚                                                                              â”‚
â”‚  Era 3: WebAssembly Bootstrap (2022-present)                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚
â”‚  - Self-hosted compiler becomes primary                                      â”‚
â”‚  - WebAssembly enables universal bootstrap                                   â”‚
â”‚  - C++ code removed from repository                                          â”‚
â”‚  - LLVM optional (only for optimizations)                                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h2 class="relative group">Summary: The Complete Picture
    <div id="summary-the-complete-picture" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#summary-the-complete-picture" aria-label="Anchor">#</a>
    </span>
    
</h2>
<pre tabindex="0"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ZIG BOOTSTRAP: THE COMPLETE PICTURE                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                          â”‚   zig1.wasm     â”‚                                 â”‚
â”‚                          â”‚  (in git repo)  â”‚                                 â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                   â”‚                                          â”‚
â”‚                          wasm2c transpilation                                â”‚
â”‚                                   â”‚                                          â”‚
â”‚                                   â–¼                                          â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                          â”‚     zig1.c      â”‚                                 â”‚
â”‚                          â”‚  (temporary)    â”‚                                 â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                   â”‚                                          â”‚
â”‚                          C compilation (cc)                                  â”‚
â”‚                                   â”‚                                          â”‚
â”‚                                   â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                           zig1 executable                               â”‚â”‚
â”‚  â”‚                                                                         â”‚â”‚
â”‚  â”‚   â€¢ Minimal Zig compiler                                                â”‚â”‚
â”‚  â”‚   â€¢ Can only output C code                                              â”‚â”‚
â”‚  â”‚   â€¢ Slow but functional                                                 â”‚â”‚
â”‚  â”‚                                                                         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                   â”‚                                          â”‚
â”‚                          Compile Zig â†’ C                                     â”‚
â”‚                                   â”‚                                          â”‚
â”‚                                   â–¼                                          â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                          â”‚     zig2.c      â”‚                                 â”‚
â”‚                          â”‚  (temporary)    â”‚                                 â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                   â”‚                                          â”‚
â”‚                          C compilation (cc)                                  â”‚
â”‚                                   â”‚                                          â”‚
â”‚                                   â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                           zig2 executable                               â”‚â”‚
â”‚  â”‚                                                                         â”‚â”‚
â”‚  â”‚   â€¢ Full Zig compiler                                                   â”‚â”‚
â”‚  â”‚   â€¢ All backends available                                              â”‚â”‚
â”‚  â”‚   â€¢ Can self-host                                                       â”‚â”‚
â”‚  â”‚                                                                         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                   â”‚                                          â”‚
â”‚                          Optional: build stage3                              â”‚
â”‚                                   â”‚                                          â”‚
â”‚                                   â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                       stage3 executable                                 â”‚â”‚
â”‚  â”‚                                                                         â”‚â”‚
â”‚  â”‚   â€¢ Production Zig compiler                                             â”‚â”‚
â”‚  â”‚   â€¢ LLVM optimizations (optional)                                       â”‚â”‚
â”‚  â”‚   â€¢ Full optimizations enabled                                          â”‚â”‚
â”‚  â”‚   â€¢ This is what ships to users                                         â”‚â”‚
â”‚  â”‚                                                                         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â”‚  KEY INSIGHT: Only need a C compiler to build Zig from source!              â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h2 class="relative group">Conclusion
    <div id="conclusion" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#conclusion" aria-label="Anchor">#</a>
    </span>
    
</h2>
<p>Zig&rsquo;s bootstrap process is a masterpiece of practical engineering:</p>
<ol>
<li><strong>WebAssembly</strong> provides a portable, deterministic binary format</li>
<li><strong>wasm2c</strong> transpiles WebAssembly to portable C99</li>
<li><strong>WASI</strong> provides a minimal system interface</li>
<li><strong>C backend</strong> allows Zig to output C code</li>
<li><strong>Multi-stage bootstrap</strong> progressively builds better compilers</li>
</ol>
<p>The result: Zig can be built from source on virtually any platform with just a C compiler, no other dependencies required.</p>
<p>In the next article, we&rsquo;ll dive into the first stage of the actual compilation pipeline: the <strong>Tokenizer</strong>, which converts source code into tokens.</p>
<hr>
<p><strong>Next</strong>: <a
  href="./02-tokenizer.md">Part 2: The Tokenizer</a></p>
<p><strong>Series Index</strong>:</p>
<ol>
<li><strong>Bootstrap Process</strong> (this article)</li>
<li><a
  href="./02-tokenizer.md">Tokenizer</a></li>
<li><a
  href="./03-parser-ast.md">Parser and AST</a></li>
<li><a
  href="./04-zir-generation.md">ZIR Generation</a></li>
<li><a
  href="./05-sema.md">Semantic Analysis</a></li>
<li><a
  href="./06-air-codegen.md">AIR and Code Generation</a></li>
<li><a
  href="./07-linking.md">Linking</a></li>
</ol>
<hr>

<h2 class="relative group">Further Reading
    <div id="further-reading" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none">
        <a class="text-primary-300 dark:text-neutral-700 !no-underline" href="#further-reading" aria-label="Anchor">#</a>
    </span>
    
</h2>
<ul>
<li><a
  href="https://ziglang.org/documentation/master/"
    target="_blank"
  >Zig Language Reference</a></li>
<li><a
  href="https://github.com/ziglang/zig"
    target="_blank"
  >Zig Source Code</a></li>
<li><a
  href="https://webassembly.github.io/spec/"
    target="_blank"
  >WebAssembly Specification</a></li>
<li><a
  href="https://wasi.dev/"
    target="_blank"
  >WASI Specification</a></li>
<li><a
  href="https://en.wikipedia.org/wiki/LEB128"
    target="_blank"
  >LEB128 Encoding</a> (used in WebAssembly)</li>
</ul>

          
          
          
        </div>
        
        

        

        

      </div>

      
      
        
        
          
          
        
        
        
        <script
          type="text/javascript"
          src="/js/page.min.54b6f4371722649edbe871e431d8670d670878c22be8f36e229fe53cc9b786fe25a834def5e6de621f7a3e37b72bc8cd73839aa5ed907ed6cbd45cd3e1b0fa20.js"
          integrity="sha512-VLb0NxciZJ7b6HHkMdhnDWcIeMIr6PNuIp/lPMm3hv4lqDTe9ebeYh96Pje3K8jNc4Oape2QftbL1FzT4bD6IA=="
          data-oid="views_drafts/01-bootstrap-process.md"
          data-oid-likes="likes_drafts/01-bootstrap-process.md"></script>
      
    </section>

    
    <footer class="pt-8 max-w-prose print:hidden">
      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600">
      <div class="flex justify-between pt-3">
        <span class="flex flex-col">
          
            <a
              class="flex text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
              href="/drafts/02-tokenizer/">
              <span class="leading-6">
                <span class="inline-block rtl:rotate-180">&larr;</span>&ensp;Zig Compiler Internals Part 2: The Tokenizer
              </span>
            </a>
            
              <span class="ms-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400">
                <time datetime="2025-12-17T00:00:00&#43;00:00">December 17, 2025</time>
              </span>
            
          
        </span>
        <span class="flex flex-col items-end">
          
            <a
              class="flex text-right text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
              href="/drafts/09-build-system/">
              <span class="leading-6">
                Part 9: The Build System (build.zig)&ensp;<span class="inline-block rtl:rotate-180">&rarr;</span>
              </span>
            </a>
            
              <span class="me-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400">
                <time datetime="2025-12-17T00:00:00&#43;00:00">December 17, 2025</time>
              </span>
            
          
        </span>
      </div>
    </div>
  


      
    </footer>
  </article>

        


  






<div
  id="scroll-to-top"
  class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200">
  <a
    href="#the-top"
    class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top"
    title="Scroll to top">
    &uarr;
  </a>
</div>

      </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
  
  <div class="flex items-center justify-between">
    
    
      <p class="text-sm text-neutral-500 dark:text-neutral-400">
          &copy;
          2025
          Yohai
      </p>
    

    
    
      <p class="text-xs text-neutral-500 dark:text-neutral-400">
        
        
        Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
          href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
          href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a>
      </p>
    
  </div>
  
    <script>
      mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
        margin: 24,
        background: "rgba(0,0,0,0.5)",
        scrollOffset: 0,
      });
    </script>
  
  
  
  <script
    type="text/javascript"
    src="/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js"
    integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500"
  data-url="http://localhost:1313/">
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800">
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          <span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0">
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)">
        <span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
  
</html>
